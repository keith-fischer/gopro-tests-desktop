
<html>
   <head>
      <style type="text/css">
         .sikuli-code {
            font-size: 20px;
            font-family: "Osaka-mono", Monospace;
            line-height: 1.5em;
            display:table-cell;
            white-space: pre-wrap;       /* css-3 */
            white-space: -moz-pre-wrap !important;  /* Mozilla, since 1999 */
            white-space: -pre-wrap;      /* Opera 4-6 */
            white-space: -o-pre-wrap;    /* Opera 7 */
            word-wrap: break-word;       /* Internet Explorer 5.5+ */
            width: 99%;   /* remove horizontal scroll-bar when viewing in IE7 */
         }
         .sikuli-code img {
            vertical-align: middle;
            margin: 2px;
            border: 1px solid #ccc;
            padding: 2px;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            -moz-box-shadow: 1px 1px 1px gray;
            -webkit-box-shadow: 1px 1px 2px gray;
         }
         .kw {
            color: blue;
         }
         .skw {
            color: rgb(63, 127, 127);
         }

         .str {
            color: rgb(128, 0, 0);
         }

         .dig {
            color: rgb(128, 64, 0);
         }

         .cmt {
            color: rgb(200, 0, 200);
         }

         h2 {
            display: inline;
            font-weight: normal;
         }

         .info {
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 20px;
            display: none;
         }

         a {
            color: #9D2900;
         }

         body {
            font-family: "Trebuchet MS", Arial, Sans-Serif;
         }

      </style>
   </head>
<body>
<div class="info">
<h2>gda_create_tests.sikuli</h2> <a href="gda_create_tests.zip">(Download this script)</a>
</div>
<pre class="sikuli-code">
<span class="cmt">#Quik Mac 2.3.0.6081</span>
<span class="kw">import</span> os
<span class="kw">import</span> sys
<span class="kw">import</span> traceback
<span class="kw">import</span> platform
<span class="kw">from</span> datetime <span class="kw">import</span> datetime
<span class="kw">from</span> os.path <span class="kw">import</span> expanduser
<span class="kw">import</span> json
<span class="kw">import</span> org.sikuli.script.ImagePath
<span class="kw">import</span> shutil
<span class="kw">from</span> random <span class="kw">import</span> randint
<span class="kw">from</span> time <span class="kw">import</span> strftime
<span class="kw">from</span> types <span class="kw">import</span> *
<span class="kw">from</span> sikuli <span class="kw">import</span> Sikuli
<span class="kw">from</span> sikuli <span class="kw">import</span> *
<span class="kw">from</span> __builtin__ <span class="kw">import</span> True, False
<span class="kw">import</span> org.sikuli.basics.SikulixForJython

<span class="kw">import</span> gda_utils
<span class="kw">import</span> gda_music_tests

d_report = {}
momentstestcounter = <span class="dig">0</span>
<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># window size=(630, 10, w1918, h857)</span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>

<span class="kw">def</span> scrubtest(REGION):

    scrub60=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"4VIDEOS"</span>,Pattern(<img src="scrub-60.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">270</span>,<span class="dig">0</span>))
    <span class="kw">if</span> scrub60:
        scrub60.highlight(<span class="dig">1</span>)
        <span class="cmt">#p=(Pattern("scrub-60.png").similar(0.69).targetOffset(-270,0)</span>
        hover(scrub60)
        x=scrub60.getX()
        y=scrub60.getY()+<span class="dig">40</span>
        count=<span class="dig">1</span>
        step=<span class="dig">5</span>
        steps=[]
        st=<span class="dig">10</span>
        w=<span class="dig">3</span>
        w1=<span class="dig">5</span>
        <span class="kw">for</span> i <span class="kw">in</span> range(<span class="dig">1</span>,scrub60.getW(),step):
            <span class="kw">print</span> x
            hover(Location(x+i,y))

            <span class="cmt">#scrub60.mouseMove(Location(x,0))</span>
            <span class="kw">if</span> count==<span class="dig">1</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player1.png" />).similar(<span class="dig">0.83</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">2</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player2.png" />).similar(<span class="dig">0.85</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">3</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player3.png" />).similar(<span class="dig">0.86</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">4</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player4.png" />).similar(<span class="dig">0.74</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">5</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player5.png" />).similar(<span class="dig">0.74</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">6</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player6.png" />).similar(<span class="dig">0.82</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">7</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player7.png" />).similar(<span class="dig">0.87</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">8</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player8.png" />).similar(<span class="dig">0.72</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">9</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player9.png" />).similar(<span class="dig">0.72</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">10</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player10.png" />).similar(<span class="dig">0.72</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">11</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player11.png" />).similar(<span class="dig">0.85</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">12</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player12.png" />).similar(<span class="dig">0.72</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">13</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player13.png" />).similar(<span class="dig">0.84</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=<span class="dig">5</span>
            <span class="kw">elif</span> count==<span class="dig">14</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player14.png" />).similar(<span class="dig">0.73</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">15</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player15.png" />).similar(<span class="dig">0.72</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">elif</span> count==<span class="dig">16</span>:
                m=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"PLAYER"</span>,Pattern(<img src="player16.png" />).similar(<span class="dig">0.71</span>),w)
                <span class="kw">if</span> m:
                    steps.append(count)
                    m.highlight(<span class="dig">1</span>)
                    count+=<span class="dig">1</span>
                    step=st
                <span class="kw">else</span>:
                    step=w1
            <span class="kw">else</span>:
                <span class="kw">break</span>
        <span class="kw">print</span> str(steps)


<span class="kw">def</span> selectmediaforstory(REGION):

    gda_utils.WAIT(REGION,Pattern(<img src="view_btn_view-create.png" />).similar(<span class="dig">0.98</span>),<span class="dig">5</span>)  <span class="cmt">#media_txt_media-editor.png</span>
    gda_utils.CLICK(REGION,Pattern(<img src="view_btn_view-create.png" />).similar(<span class="dig">0.98</span>).targetOffset(<span class="dig">55</span>,<span class="dig">2</span>))  <span class="cmt">#media_txt_media-editor.png</span>
    gda_utils.WAIT(REGION,Pattern(<img src="create_txt_media.png" />).similar(<span class="dig">0.71</span>),<span class="dig">10</span>) <span class="cmt"># media_btn_selected-media.png</span>

    <span class="cmt">#gda_utils.click(Pattern("media_btn_selected.png").similar(0.98)) #media_btn_selected</span>
    gda_utils.WAIT(REGION,Pattern(<img src="editor_btn_selected.png" />).similar(<span class="dig">0.98</span>),<span class="dig">10</span>) <span class="cmt">#editor_btn_selected</span>

    gda_utils.FIND(REGION,Pattern(<img src="editor_img_1-4.png" />).exact().targetOffset(-<span class="dig">138</span>,<span class="dig">3</span>)) <span class="cmt"># editor_img_1-4.png</span>
    gda_utils.FIND(REGION,Pattern(<img src="editor_img_5-8.png" />).exact().targetOffset(-<span class="dig">135</span>,<span class="dig">2</span>)) <span class="cmt"># editor_img_5-8.png</span>
    gda_utils.FIND(REGION,Pattern(<img src="editor_img_9-12.png" />).exact().targetOffset(-<span class="dig">137</span>,<span class="dig">2</span>)) <span class="cmt"># editor_img_9-12.png</span>
    gda_utils.FIND(REGION,Pattern(<img src="editor_img_13-16.png" />).exact().targetOffset(-<span class="dig">137</span>,<span class="dig">4</span>)) <span class="cmt"># editor_img_13-16.png</span>


<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################    </span>
<span class="kw">def</span> popup_areyousure_deletefile(REGION):
    rc=False
    foundreg=gda_utils.EXISTS2(REGION,Pattern(<img src="popup_txt_title-AREYOUSURE.png" />).similar(<span class="dig">0.98</span>))
    <span class="kw">if</span> foundreg:
        foundreg.highlight(<span class="dig">1</span>)
        subreg=foundreg.below(<span class="dig">200</span>)
        subreg=subreg.grow(<span class="dig">30</span>)
        subreg.highlight(<span class="dig">1</span>)
    <span class="cmt">#gda_utils.FIND(REGION,)</span>
    <span class="cmt">#rc=gda_utils.FIND(REGION,Pattern("popup_txt_info-willpermanentlydeletefile.png").similar(0.92))</span>
        rc=gda_utils.CLICK2(subreg,Pattern(<img src="popup_btn_delete-areyousure.png" />).similar(<span class="dig">0.88</span>))
    <span class="kw">return</span> rc

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># returns true if the png of "Title" is found in textbox after textfield text is clear</span>
<span class="cmt">######################################  </span>
<span class="kw">def</span> cleartextfield(regionclick,validateclear=Pattern(<img src="popup_txt_title-mp4filenamesave.png" />).similar(<span class="dig">0.68</span>)):
    <span class="kw">print</span> <span class="str">"cleartextfield:&gt;&gt;&gt;&gt;&gt;"</span>
    rc=False
    <span class="skw">wait</span>(<span class="dig">1</span>)

    <span class="kw">if</span> gda_utils.d_gda_settings[<span class="str">"isWindows"</span>]==<span class="str">"True"</span>:
        regionclick.<span class="skw">click</span>()
        <span class="skw">wait</span>(<span class="dig">1</span>)

        regionclick.keyDown(Key.CTRL)
        <span class="skw">wait</span>(<span class="dig">1</span>)

        regionclick.<span class="skw">type</span>(<span class="str">"a"</span>)
        <span class="skw">wait</span>(<span class="dig">1</span>)

        regionclick.keyUp(Key.CTRL)
        <span class="skw">wait</span>(<span class="dig">1</span>)

        regionclick.<span class="skw">type</span>(Key.BACKSPACE)
    <span class="kw">elif</span> gda_utils.d_gda_settings[<span class="str">"isMac"</span>]==<span class="str">"True"</span>:
        regionclick.<span class="skw">click</span>()
        <span class="skw">wait</span>(<span class="dig">1</span>)

        regionclick.keyDown(Key.CMD)
        <span class="skw">wait</span>(<span class="dig">1</span>)

        regionclick.<span class="skw">type</span>(<span class="str">"a"</span>)
        <span class="skw">wait</span>(<span class="dig">1</span>)

        regionclick.keyUp(Key.CMD)
        <span class="skw">wait</span>(<span class="dig">1</span>)

        regionclick.<span class="skw">type</span>(Key.BACKSPACE)
    <span class="skw">wait</span>(<span class="dig">2</span>)
    <span class="cmt">#regionclick=regionclick.grow(20)</span>
    regionclick.highlight(<span class="dig">1</span>)
    m = regionclick.exists(validateclear)
    <span class="kw">if</span> <span class="kw">not</span> m:
        <span class="kw">print</span> <span class="str">"Failed to clear textfield"</span>
        regionclick.highlight(<span class="dig">5</span>)
    <span class="kw">else</span>:
        rc=True

    <span class="kw">print</span> <span class="str">"cleartextfield:&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc

<span class="cmt">######################################</span>
<span class="cmt"># save btn, type filename(song), cancel share,returns to editor</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">###################################### </span>
<span class="kw">def</span> exportmp4(REGION,d_song,png,duration):
    <span class="kw">print</span> <span class="str">"exportmp4 &gt;&gt;&gt;&gt;&gt; %d - %s"</span> % (duration,png)
    rc=False
    saveresult=<span class="str">"mp4saveresult_%d"</span> % duration
    d_song[saveresult]=<span class="str">"FAILED"</span>

    dur=<span class="str">"_%d"</span> % duration
    mp4=png.replace(<img src=".png" />,dur)
    mp4=mp4.replace(<span class="str">"_"</span>,<span class="str">""</span>)
    btnsave_blk=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"BOTTOM"</span>,Pattern(<img src="create_btn_save-nohover.png" />).similar(<span class="dig">0.68</span>))
    <span class="kw">if</span> <span class="kw">not</span> btnsave_blk:
        <span class="kw">print</span> <span class="str">"Save button not found"</span>
        <span class="kw">print</span> <span class="str">"exportmp4 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>
        <span class="kw">return</span> rc, d_song
    <span class="cmt">#hover(btnsave)</span>
    <span class="cmt">#btnsave_blu=gda_utils.EXISTS3("CREATE","BOTTOM",Pattern("create_btn_save-hover.png").similar(0.80))</span>
    btnsave_blk.<span class="skw">click</span>()
    <span class="skw">wait</span>(<span class="dig">5</span>)
    rpop=gda_utils.EXISTS2(REGION,Pattern(<img src="popup_lbl_nameyournewvideo.png" />).similar(<span class="dig">0.68</span>),<span class="dig">120</span>)
    <span class="kw">if</span> <span class="kw">not</span> rpop:
        <span class="kw">print</span> <span class="str">"FAILED: Popup for video save dialog %s"</span> % mp4
        <span class="kw">print</span> <span class="str">"exportmp4 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>
        REGION.<span class="skw">click</span>(Pattern(<img src="create-popup-save_btn_cancel.png" />).similar(<span class="dig">0.69</span>))
        <span class="kw">return</span> rc, d_song
    rpop = rpop.below(<span class="dig">70</span>)
    rpop.highlight(<span class="dig">5</span>)
    mlbl=gda_utils.EXISTS2(rpop,Pattern(<img src="popup_txt_info-findvideosineditsview.png" />).similar(<span class="dig">0.69</span>))
    <span class="kw">if</span> mlbl:
        rpop=mlbl.left(<span class="dig">1</span>)
        rpop=rpop.right(<span class="dig">600</span>)
        rpop=rpop.below(<span class="dig">300</span>)
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"FAILED: Popup to find textbox video save %s"</span> % mp4
        <span class="kw">print</span> <span class="str">"info label not found: You'll find your video in the Edits view"</span>
        <span class="kw">print</span> <span class="str">"exportmp4 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>
        rpop.<span class="skw">click</span>(Pattern(<img src="create-popup-save_btn_cancel.png" />).similar(<span class="dig">0.69</span>))
        <span class="kw">return</span> rc, d_song
    rpop.highlight(<span class="dig">2</span>)
    mtxt=gda_utils.EXISTS2(rpop,Pattern(<img src="popup_txt_title-mp4filenamesave.png" />).similar(<span class="dig">0.68</span>))
    <span class="kw">if</span> <span class="kw">not</span> mtxt:
        r1=gda_utils.EXISTS2(rpop,Pattern(<img src="create-popup-save_lbl_Quality.png" />).similar(<span class="dig">0.68</span>))
        <span class="kw">if</span> r1:
            r2=r1.left(<span class="dig">5</span>)
            r1=r2.right(<span class="dig">100</span>)
            r2=r1.above(<span class="dig">300</span>)
            r2.highlight(<span class="dig">1</span>)
            r1=gda_utils.EXISTS2(r2,Pattern(<img src="create-popup-save_img_textboxLeftborder.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">70</span>,<span class="dig">0</span>))
            <span class="kw">if</span> r1:
                r1.<span class="skw">click</span>(Pattern(<img src="create-popup-save_img_textboxLeftborder.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">70</span>,<span class="dig">0</span>))
                <span class="skw">wait</span>(<span class="dig">1</span>)
                r1.<span class="skw">click</span>(Pattern(<img src="create-popup-save_img_textboxLeftborder.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">70</span>,<span class="dig">0</span>))
                <span class="skw">wait</span>(<span class="dig">1</span>)
            <span class="cmt">#mtxt.click(Pattern("popup_txt_title_song.png").similar(0.69).targetOffset(283,0))</span>

                <span class="kw">if</span> <span class="kw">not</span> cleartextfield(r1.right(<span class="dig">100</span>)):
                    <span class="kw">print</span> <span class="str">"FAILED: Popup to clear textbox with song name %s"</span> % mp4
                    <span class="kw">print</span> <span class="str">"'song' name not foundew"</span>
                    <span class="kw">print</span> <span class="str">"exportmp4 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>
                    rpop.<span class="skw">click</span>(Pattern(<img src="create-popup-save_btn_cancel.png" />).similar(<span class="dig">0.69</span>))
                    <span class="kw">return</span> rc, d_song
                mtxt=gda_utils.EXISTS2(rpop,Pattern(<img src="popup_txt_title-mp4filenamesave.png" />).similar(<span class="dig">0.68</span>))
            <span class="kw">else</span>:
                <span class="kw">print</span> <span class="str">"FAILED: Popup to find textbox left edge for clearing old text"</span>

                <span class="kw">print</span> <span class="str">"exportmp4 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>
                rpop.<span class="skw">click</span>(Pattern(<img src="create-popup-save_btn_cancel.png" />).similar(<span class="dig">0.69</span>))
                <span class="kw">return</span> rc, d_song
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"FAILED: Popup to find textbox with song name %s"</span> % mp4
            <span class="kw">print</span> <span class="str">"info label not found: You'll find your video in the Edits view"</span>
            <span class="kw">print</span> <span class="str">"exportmp4 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>
            rpop.<span class="skw">click</span>(Pattern(<img src="create-popup-save_btn_cancel.png" />).similar(<span class="dig">0.69</span>))
            <span class="kw">return</span> rc, d_song

    <span class="skw">wait</span>(<span class="dig">1</span>)

    mtxt.<span class="skw">click</span>()
    <span class="skw">wait</span>(<span class="dig">1</span>)
    mtxt.<span class="skw">click</span>()
    <span class="skw">wait</span>(<span class="dig">1</span>)
    <span class="kw">print</span> <span class="str">"TYPING TITLE NAME: %s"</span> % mp4
    mtxt.<span class="skw">type</span>(mp4)
    mtxt=gda_utils.EXISTS2(rpop,Pattern(<img src="popup_btn_save-exportvideo.png" />).similar(<span class="dig">0.72</span>))
    savename=<span class="str">"mp4savename_%d"</span> % duration
    d_song[savename]=mp4
    <span class="kw">if</span> <span class="kw">not</span> mtxt:
        <span class="kw">print</span> <span class="str">"FAILED: Popup to find textbox video save %s"</span> % mp4
        <span class="kw">print</span> <span class="str">"exportmp4 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>
        rpop.<span class="skw">click</span>(Pattern(<img src="create-popup-save_btn_cancel.png" />).similar(<span class="dig">0.69</span>))
        <span class="kw">return</span> rc, d_song
    mtxt.<span class="skw">click</span>()
    <span class="skw">wait</span>(<span class="dig">1</span>)
    mtxt.<span class="skw">click</span>()
    dta = datetime.now()
    mpopsave=gda_utils.EXISTS2(REGION,Pattern(<img src="popup_txt_savingtoedits.png" />).similar(<span class="dig">0.69</span>),<span class="dig">30</span>)
    <span class="kw">if</span> <span class="kw">not</span> mpopsave:
        <span class="kw">print</span> <span class="str">"FAILED: Popup to show save progress %s"</span> % mp4
        <span class="kw">print</span> <span class="str">"exportmp4 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>
        <span class="kw">return</span> rc, d_song
    <span class="skw">wait</span>(<span class="dig">1</span>)

    blu_view_status=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"TITLE"</span>,Pattern(<img src="view_txt_selectbarstatus-1itemselected.png" />).similar(<span class="dig">0.69</span>),<span class="dig">700</span>)
    <span class="kw">if</span> <span class="kw">not</span> blu_view_status:
        <span class="kw">print</span> <span class="str">"Failed: View status blue bar not found selected on new output mp4"</span>
        <span class="kw">print</span> <span class="str">"exportmp4 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>
        <span class="kw">return</span> rc, d_song

    dtb = datetime.now()
    dtc=dtb-dta
    blu_view_status.highlight(<span class="dig">1</span>)
    savesecs=<span class="str">"mp4savetime_%d"</span> % duration
    d_song[savesecs]=dtc.seconds
    <span class="kw">print</span> <span class="str">"===================================="</span>
    <span class="kw">print</span> <span class="str">"%d SECONDS =============================="</span> % dtc.seconds
    <span class="kw">print</span> <span class="str">"===================================="</span>
    <span class="skw">wait</span>(<span class="dig">1</span>)

    blu_view_status.<span class="skw">click</span>(Pattern(<img src="view_txt_selectbarstatus-1itemselected.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">81</span>,<span class="dig">0</span>))
    <span class="skw">wait</span>(<span class="dig">1</span>)

    <span class="kw">if</span> nav_view_to_create(REGION):
        saveresult=<span class="str">"mp4saveresult_%d"</span> % duration
        d_song[saveresult]=<span class="str">"PASSED"</span>
        rc=True
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"Failed: navigate to create screen"</span>
        <span class="kw">print</span> <span class="str">"exportmp4 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>

    <span class="kw">print</span> <span class="str">"exportmp4 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc, d_song

<span class="kw">def</span> view_delete_selected(REGION):
    rc = False
    <span class="kw">print</span> <span class="str">"&gt;&gt;&gt;&gt;&gt;&gt;view_delete_selected"</span>
    blu_view_status=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"TITLE"</span>,Pattern(<img src="view_txt_selectbarstatus-1itemselected.png" />).similar(<span class="dig">0.69</span>),<span class="dig">30</span>)
    <span class="kw">if</span> <span class="kw">not</span> blu_view_status:
        <span class="kw">print</span> <span class="str">"Failed: View status blue bar not found selected on new output mp4"</span>
        <span class="kw">print</span> <span class="str">"view_delete_selected &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>
        <span class="kw">return</span> rc, d_song
    statusregion=blu_view_status.right(<span class="dig">650</span>)
    statusregion=statusregion.grow(<span class="dig">10</span>)
    statusregion.highlight(<span class="dig">1</span>)
    itemdelete=gda_utils.EXISTS2(statusregion,Pattern(<img src="view_btn_bluitemselectedbar-delete.png" />).similar(<span class="dig">0.71</span>),<span class="dig">30</span>)
    <span class="kw">if</span> itemdelete:
        itemdelete.highlight(<span class="dig">1</span>)
        itemdelete.<span class="skw">click</span>()
        <span class="kw">if</span> popup_areyousure_deletefile(REGION):
            rc=True
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"Failed: View status blue bar Delete button not found"</span>
        <span class="kw">print</span> <span class="str">"view_delete_selected &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;!"</span>

    <span class="kw">return</span> rc


<span class="kw">def</span> nav_view_to_create(REGION):
    <span class="kw">print</span> <span class="str">"&gt;&gt;&gt;&gt;&gt;&gt;nav_view_to_create"</span>
    rc=False
    createm=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"TOP"</span>,Pattern(<img src="view_btn_create-tab.png" />).similar(<span class="dig">0.69</span>),<span class="dig">30</span>)
    <span class="kw">if</span> createm:
        createm.<span class="skw">click</span>()
        <span class="kw">if</span> gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"TITLE"</span>,Pattern(<img src="create_txt_media.png" />).similar(<span class="dig">0.71</span>),<span class="dig">30</span>):
            rc= True
    <span class="kw">else</span>:
        <span class="kw">print</span>(<span class="str">"FAILED nav_view_to_create"</span>)
    <span class="kw">print</span> <span class="str">"&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; nav_view_to_create"</span>

    <span class="kw">return</span> rc
<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################    </span>
<span class="kw">def</span> init_music(REGION,msongs):
    gda_utils.CLICK(REGION,Pattern(<img src="editor_img_1-4.png" />).exact().targetOffset(-<span class="dig">138</span>,<span class="dig">3</span>),<span class="dig">1</span>,False) <span class="cmt"># editor_img_1-4.png</span>
    <span class="cmt">#selectmusic(REGION) # editor_img_music-duration</span>
    <span class="kw">if</span> selectmusic(REGION):
        <span class="kw">if</span> gda_utils.FIND(REGION,Pattern(<img src="music_btn_music-selected.png" />).similar(<span class="dig">0.71</span>)):
            <span class="kw">if</span> gda_music_tests.resetscrolltotop(REGION):
                p=gda_utils.PATTERN(msongs.getFirstSongItem(),<span class="dig">0.69</span>)
                gda_music_tests.EXISTS(REGION,p,None,False)
                gda_music_tests.addtovideo(REGION)
                <span class="kw">return</span> True
    <span class="kw">return</span> False

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt">#</span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> getdurationpopupregion(durationselectregion):
    <span class="cmt">#mselect=None</span>
    mselect=durationselectregion.grow(<span class="dig">50</span>,<span class="dig">0</span>)
    mselect=mselect.below(<span class="dig">150</span>)
    mselect.highlight(<span class="dig">1</span>)
    <span class="kw">return</span> mselect

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> selectmusicduration(REGION,duration):
    <span class="kw">print</span> <span class="str">"selectmusicduration=%d  &gt;&gt;&gt;&gt;&gt;&gt;"</span> % duration
    rc = False
    mdur60=None
    mdur30=None
    mdur15=None
    mselect=None
    nabove=<span class="dig">100</span>
    ricon=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"EDITCTRL"</span>,Pattern(<img src="create_img_duration-icon.png" />).similar(<span class="dig">0.69</span>))
    <span class="kw">if</span> ricon:
        rdur=ricon.right(<span class="dig">15</span>)
        <span class="kw">if</span> <span class="kw">not</span> rdur:
            <span class="kw">print</span> <span class="str">"Error: Moments duration region not found"</span>
            <span class="kw">return</span> rc
        <span class="kw">else</span>:
            rdur=rdur.grow(<span class="dig">15</span>)
            rdur.highlight(<span class="dig">1</span>)
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"Error: Moments duration region not found"</span>
        <span class="kw">return</span> rc

    <span class="kw">if</span> duration==<span class="dig">60</span>:
        mdur60=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-60s.png" />).similar(<span class="dig">0.80</span>))
        <span class="kw">if</span> <span class="kw">not</span> mdur60:
            mdur60=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-30s.png" />).similar(<span class="dig">0.80</span>))
            <span class="kw">if</span> <span class="kw">not</span> mdur60:
                mdur60=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-15s.png" />).similar(<span class="dig">0.80</span>))
        <span class="kw">if</span> mdur60:
            mdur60.<span class="skw">click</span>()
            mselect=getdurationpopupregion(mdur60)
            <span class="kw">if</span> mselect:
                mselect.highlight(<span class="dig">1</span>)
                <span class="kw">if</span> mselect.exists(Pattern(<img src="editor_txt_popup-duration.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">1</span>,<span class="dig">22</span>),<span class="dig">10</span>):    <span class="cmt">#editor_txt_popup-duration</span>
                    mselect.<span class="skw">click</span>(Pattern(<img src="editor_txt_popup-duration.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">1</span>,<span class="dig">22</span>))    <span class="cmt">#editor_txt_popup-duration</span>
                mdur60=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-60s.png" />).similar(<span class="dig">0.80</span>)) <span class="cmt">#  #create_img_music-duration-60s</span>
                <span class="kw">if</span> mdur60:
                    mdur60.highlight(<span class="dig">1</span>)
                    rc = True
                <span class="kw">else</span>:
                    <span class="kw">print</span> <span class="str">"FAILED to verify after selection music duration of 60Sec"</span>
            <span class="kw">else</span>:
                <span class="kw">print</span> <span class="str">"FAILED to popup music duration of 60Sec"</span>
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"FAILED to find music duration of 60Sec"</span>

    <span class="kw">elif</span> duration==<span class="dig">30</span>:
        mdur30=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-30s.png" />).similar(<span class="dig">0.80</span>))
        <span class="kw">if</span> <span class="kw">not</span> mdur30:
            mdur30=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-60s.png" />).similar(<span class="dig">0.80</span>))
            <span class="kw">if</span> <span class="kw">not</span> mdur30:
                mdur30=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-15s.png" />).similar(<span class="dig">0.80</span>))
        <span class="kw">if</span> mdur30:  <span class="cmt">#create_img_music-duration-60s</span>
            mdur30.<span class="skw">click</span>()
            mselect=getdurationpopupregion(mdur30)
            <span class="kw">if</span> mselect:
                mselect.highlight(<span class="dig">1</span>)
                <span class="kw">if</span> mselect.exists(Pattern(<img src="editor_txt_popup-duration.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">1</span>,-<span class="dig">1</span>),<span class="dig">10</span>):    <span class="cmt"># editor_txt_popup-duration.png   </span>
                    mselect.<span class="skw">click</span>(Pattern(<img src="editor_txt_popup-duration.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">1</span>,-<span class="dig">1</span>))    <span class="cmt"># editor_txt_popup-duration.png   </span>
                mdur30=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-30s.png" />).similar(<span class="dig">0.80</span>)) <span class="cmt">#  #create_img_music-duration-30s</span>
                <span class="kw">if</span> mdur30:
                    mdur30.highlight(<span class="dig">1</span>)
                    rc = True
                <span class="kw">else</span>:
                    <span class="kw">print</span> <span class="str">"FAILED to verify after selection music duration of 30Sec"</span>
            <span class="kw">else</span>:
                <span class="kw">print</span> <span class="str">"FAILED to popup music duration of 30Sec"</span>
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"FAILED to find music duration of 30Sec"</span>
    <span class="kw">elif</span> duration==<span class="dig">15</span>:
        mdur15=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-15s.png" />).similar(<span class="dig">0.80</span>)) <span class="cmt">#create_img_music-duration-60s</span>
        <span class="kw">if</span> <span class="kw">not</span> mdur15:
            mdur15=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-30s.png" />).similar(<span class="dig">0.80</span>))
            <span class="kw">if</span> <span class="kw">not</span> mdur15:
                mdur15=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-60s.png" />).similar(<span class="dig">0.80</span>))
        <span class="kw">if</span> mdur15:
            mdur15.<span class="skw">click</span>()
            mselect=getdurationpopupregion(mdur15)
            <span class="kw">if</span> mselect:
                mselect.highlight(<span class="dig">1</span>)
                <span class="kw">if</span> mselect.exists(Pattern(<img src="editor_txt_popup-duration.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">0</span>,-<span class="dig">25</span>),<span class="dig">10</span>):
                    mselect,<span class="skw">click</span>(Pattern(<img src="editor_txt_popup-duration.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">0</span>,-<span class="dig">25</span>)) <span class="cmt"># editor_txt_popup-duration.png    </span>
                mdur15=gda_utils.EXISTS2(rdur,Pattern(<img src="create_img_music-duration-15s.png" />).similar(<span class="dig">0.80</span>)) <span class="cmt">#  #create_img_music-duration-15s</span>
                <span class="kw">if</span> mdur15:  <span class="cmt">#create_img_music-duration-30s</span>
                    mdur15.highlight(<span class="dig">1</span>)
                    rc=True
                <span class="kw">else</span>:
                    <span class="kw">print</span> <span class="str">"FAILED to verify after selection music duration of 30Sec"</span>
            <span class="kw">else</span>:
                <span class="kw">print</span> <span class="str">"FAILED to popup music duration of 30Sec"</span>
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"FAILED to find music duration of 30Sec"</span>

    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"FAILED selectmusicduration: invalid duration"</span>
    <span class="kw">if</span> <span class="kw">not</span> rc:
        <span class="kw">print</span> <span class="str">"FAILED selectmusicduration:"</span>
    <span class="kw">else</span>:
        mouseMove(gda_utils.getregion(<span class="str">"CREATE"</span>,<span class="str">"TOP"</span>))
    <span class="kw">print</span> <span class="str">"selectmusicduration &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc


<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> selectmusic(REGION):
    rc=False

    r=gda_utils.getregion(<span class="str">"CREATE"</span>,<span class="str">"BOTTOM"</span>)
    r.highlight(<span class="dig">1</span>)
    m=gda_utils.EXISTS2(r,Pattern(<img src="create_btn_music.png" />).similar(<span class="dig">0.51</span>))
    <span class="kw">if</span> m:
        <span class="kw">if</span> m.<span class="skw">click</span>(r.getLastMatch())&gt;<span class="dig">0</span>:
            rc=True
    <span class="kw">return</span> rc
    <span class="cmt">#gda_utils.CLICK(r,Pattern("create_btn_music.png").similar(0.50).targetOffset(-25,2))</span>

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> set_duration_moments(REGION,momentscount,durationmode):
    selectmusicduration(REGION,durationmode)
    selectmoments(REGION,momentscount,durationmode)
    selectmusic(REGION)

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> set_duration(REGION,momentscount,durationmode):
    selectmusicduration(REGION,durationmode)
    selectmusic(REGION)

<span class="cmt">######################################</span>
<span class="cmt"># checks for moments selection popup</span>
<span class="cmt"># return the moments count,ispopup and pass true or failed false</span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> evalmomentscounts(REGION,max,count,song=<span class="str">""</span>):
    <span class="kw">global</span> d_report
    test={}
    <span class="cmt">#test['song']=song</span>
    count += <span class="dig">1</span>
    <span class="kw">print</span> <span class="str">"evalmomentscounts: &gt;&gt;&gt;&gt;&gt;&gt; count %d - max moment=%d"</span> % (count,max)
    rc = False
    ispopup=False
    done=False
    test[<span class="str">"momentpopup"</span>]=<span class="str">"FAILED"</span>
    testname=<span class="str">"MomentsPopup_%d-of-%d_%s"</span> % (count,max,song)
    <span class="kw">if</span> count&gt;(max):
        <span class="kw">print</span> <span class="str">"evalmomentscounts reached: max moment  =%d"</span> % count
        m=gda_utils.EXISTS2(REGION,Pattern(<img src="popup_txt_easydoesit.png" />).similar(<span class="dig">0.69</span>),<span class="dig">5</span>)<span class="cmt">#popup_txt_easydoesit</span>
        <span class="kw">if</span> m:
            m=gda_utils.EXISTS2(REGION,<img src="popup_btn_easydoesit-gotit.png" />,<span class="dig">5</span>)<span class="cmt">#popup_btn_easydoesit-gotit</span>
        <span class="kw">else</span>:
            rc=False
            gda_utils.ScreenShot(REGION,<span class="str">""</span>,testname)

        <span class="cmt">#  Pattern("popup_btn_easydoesit-outofhilites.png").similar(0.68).targetOffset(5,81),5)</span>

        <span class="kw">if</span> m:
            test[<span class="str">"momentpopup"</span>]=<span class="str">"PASSED"</span>
            m.<span class="skw">click</span>()
            done=True
            rc = True
        <span class="kw">else</span>:
            rc=False
            gda_utils.ScreenShot(REGION,<span class="str">""</span>,testname)
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"evalmomentscounts continue selecting moments"</span>
        test[<span class="str">"name"</span>]=<span class="str">"MomentsNOPopup-%d_of_%d-%s"</span> % (count,max,song)
        m=gda_utils.EXISTS2(REGION,Pattern(<img src="popup_btn_easydoesit-outofhilites.png" />).similar(<span class="dig">0.68</span>).targetOffset(<span class="dig">5</span>,<span class="dig">81</span>),<span class="dig">5</span>)
        <span class="kw">if</span> m:<span class="cmt">#popup out of synch with max</span>
            gda_utils.ScreenShot(REGION,<span class="str">""</span>,testname)
            m.<span class="skw">click</span>()
            done=True
        <span class="kw">else</span>:<span class="cmt">#not found</span>
            test[<span class="str">"momentpopup"</span>]=<span class="str">"PASSED"</span>
            rc=True
    <span class="kw">print</span> <span class="str">"evalmomentscounts: &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> count,done,rc,test



<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################        </span>
<span class="kw">def</span> selectmoment(REGION,PATTERN,momentid,momentcount,duration,song):
    <span class="kw">global</span> d_report
    vid=PATTERN.getFilename()<span class="cmt">#fullpath</span>
    png=song
    song=song.replace(<img src=".png" />,<span class="str">""</span>)
    testname=<span class="str">"selectmoment-%dsec-%d_of_%d-%s"</span> % (duration,momentid,momentcount,song)
    <span class="kw">print</span> testname
    status=gda_utils.CLICK3(<span class="str">"CREATE"</span>,<span class="str">"4VIDEOS"</span>,PATTERN,<span class="dig">5</span>,True)
    <span class="cmt">#status=gda_utils.CLICK(REGION,PATTERN,2)</span>
    test={}
    test[<span class="str">'name'</span>]=testname
    test[<span class="str">'song'</span>]=png
    test[<span class="str">'video'</span>]=vid

    <span class="kw">if</span> status:
        <span class="kw">print</span> <span class="str">"PASSED:%s"</span> % testname
        test[<span class="str">'status'</span>]=<span class="str">"PASSED"</span>
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"FAILED:%s"</span> % testname
        test[<span class="str">'status'</span>]=<span class="str">"FAILED"</span>
        gda_utils.ScreenShot(REGION,<span class="str">""</span>,testname)
    <span class="kw">return</span> test
    <span class="cmt">#d_report['processed_songs'].append(test)</span>


<span class="cmt">######################################</span>
<span class="cmt"># predefined moment locations based on the GDA tests </span>
<span class="cmt"># with numeric videios of four 8min videos</span>
<span class="cmt"># </span>
<span class="cmt">######################################    </span>
<span class="kw">def</span> selectmoments(REGION, momentscount,durationmode,png=<span class="str">""</span>):
    <span class="kw">global</span> d_report
    passfail = False
    rc=False
    status=<span class="dig">0</span>
    <span class="kw">print</span> <span class="str">"======================================================="</span>
    <span class="kw">print</span> <span class="str">"selectmoments for %d Secs = %d &gt;&gt;&gt;"</span> % (durationmode,momentscount)
    <span class="kw">if</span> <span class="kw">not</span> selectmusicduration(REGION,<span class="dig">60</span>):
        <span class="kw">return</span> passfail
    mcount = <span class="dig">0</span>
    test={}
    testselect={}
    <span class="cmt">#1=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_1-4.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">142</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_1-4.png</span>

    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#2=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_1-4.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">4</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_1-4.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#3=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_1-4.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">132</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_1-4.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test

    <span class="cmt">#4=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_1-4.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">269</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_5-8.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#5=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_5-8.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">142</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_5-8.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#6=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_5-8.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">5</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_5-8.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test

    <span class="cmt">#7=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_5-8.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">132</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_9-12.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#8=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_5-8.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">268</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_9-12.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test

    <span class="cmt">#9=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_9-12.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">142</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_9-12.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test

    <span class="cmt">#10=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_9-12.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">5</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_13-16.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#11=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_9-12.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">132</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_13-16.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#12=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_9-12.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">269</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_13-16.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test

    <span class="cmt">#13=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_13-16.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">141</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png)<span class="cmt"># editor_img_1-4.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        <span class="kw">return</span> passfail,test
    <span class="cmt">#14=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_13-16.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">4</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_1-4.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#15=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_13-16.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">134</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_1-4.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#16=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_13-16.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">270</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_1-4.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test

    <span class="cmt">#17=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_1-4.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">269</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_5-8.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test

    <span class="cmt">#18=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_1-4.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">132</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_5-8.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test

    <span class="cmt">#19=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_1-4.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">5</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_5-8.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test

    <span class="cmt">#20=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_1-4.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">142</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_5-8.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#21=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_5-8.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">269</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_9-12.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#22=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_5-8.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">132</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_9-12.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#23=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_5-8.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">5</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_9-12.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#24=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_5-8.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">143</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_9-12.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#25=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_9-12.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">269</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_13-16.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#26=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_9-12.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">131</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_13-16.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#27=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_9-12.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">5</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_13-16.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#28=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_9-12.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">142</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_13-16.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test

    <span class="cmt">#29=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_13-16.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">268</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png)<span class="cmt"># editor_img_1-4.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#30=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_13-16.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">131</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_1-4.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#31=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_13-16.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">6</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_1-4.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test
    <span class="cmt">#32=========================</span>
    testselect=selectmoment(REGION,Pattern(<img src="editor_img_13-16.png" />).similar(<span class="dig">0.69</span>).targetOffset(<span class="dig">143</span>,<span class="dig">0</span>),mcount+<span class="dig">1</span>,momentscount,durationmode,png) <span class="cmt"># editor_img_1-4.png</span>
    mcount,done,passfail,test=evalmomentscounts(REGION,momentscount,mcount,png)
    <span class="kw">if</span> done:
        <span class="kw">print</span> <span class="str">"selectmoments=%d - duration mode=%d"</span> % (momentscount,durationmode)
        test[<span class="str">"momentselect"</span>]=testselect
        <span class="kw">return</span> passfail,test

    <span class="kw">print</span> <span class="str">"========================================================"</span>
    <span class="kw">print</span> <span class="str">"FAILED past end 32 selectmoments=%d - duration mode=%d count=%d\n%s"</span> % (momentscount,durationmode,mcount,png)
    <span class="kw">print</span> <span class="str">"========================================================"</span>
    <span class="kw">return</span> False,test

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> clearstory(REGION):
    rc=False
    <span class="kw">print</span> <span class="str">"clearstory &gt;&gt;&gt;&gt;&gt;&gt;"</span>
    r=gda_utils.getregion(<span class="str">"CREATE"</span>,<span class="str">"MOMENTS"</span>)
    r.highlight(<span class="dig">1</span>)
    m=gda_utils.EXISTS2(r,Pattern(<img src="editor_img_emptystory.png" />).similar(<span class="dig">0.50</span>),<span class="dig">10</span>)
    <span class="kw">if</span> m:
        <span class="kw">print</span> <span class="str">"clearstory &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
        <span class="kw">return</span> True
    rp=gda_utils.getregion(<span class="str">"CREATE"</span>,<span class="str">"EDITCTRL"</span>)
    rp.highlight(<span class="dig">2</span>)

    <span class="cmt">#rp=rp.below(75)</span>
    <span class="cmt">#rp.highlight(20)</span>
    rc=gda_utils.CLICK2(rp,Pattern(<img src="editor_btn_clear.png" />).similar(<span class="dig">0.69</span>)) <span class="cmt"># editor_btn_clear.png</span>
    <span class="kw">if</span> rc:
        rc=popup_areyousure(REGION)
    m=gda_utils.EXISTS2(r,Pattern(<img src="editor_img_emptystory.png" />).similar(<span class="dig">0.50</span>),<span class="dig">20</span>) <span class="cmt"># editor_img_music-duration-60s.png</span>
    <span class="kw">if</span> m:
        m.highlight(<span class="dig">1</span>)
        rc= True
    <span class="kw">print</span> <span class="str">"clearstory &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc
<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> popup_keepstory(REGION):
    gda_utils.FIND(REGION,Pattern(<img src="popup_txt_title-KEEPTHISSTORY.png" />).similar(<span class="dig">0.98</span>))
    <span class="cmt">#gda_utils.FIND(REGION,Pattern("popup_txt_info-doyouwanttoclear.png").similar(0.98))</span>
    <span class="cmt">#click(Pattern("popup_btn_KEEPIT.png").similar(0.98))</span>
    gda_utils.CLICK(REGION,Pattern(<img src="popup_btn_CLEARIT.png" />).similar(<span class="dig">0.98</span>))

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################    </span>
<span class="kw">def</span> popup_areyousure(REGION):
    rc=False
    rc=gda_utils.FIND(REGION,Pattern(<img src="popup_txt_title-AREYOUSURE.png" />).similar(<span class="dig">0.98</span>))
    <span class="cmt">#gda_utils.FIND(REGION,)</span>
    <span class="cmt">#rc=gda_utils.FIND(REGION,Pattern("popup_txt_info-Areyousureyouwanttodothis.png").similar(0.98))</span>
    rc=gda_utils.CLICK(REGION,Pattern(<img src="popup_btn_ok-areyousure.png" />).similar(<span class="dig">0.98</span>))
    <span class="kw">return</span> rc

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> getbeatregion(REGION):
    <span class="kw">if</span> gda_utils.d_gda_settings[<span class="str">"isWindows"</span>]==<span class="str">"True"</span>:
        <span class="kw">return</span> getbeatswinregion(REGION)
    <span class="kw">elif</span> gda_utils.d_gda_settings[<span class="str">"isMac"</span>]==<span class="str">"True"</span>:
        <span class="kw">return</span> getbeatsmacregion(REGION)
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"ERROR: Invalid platform not Mac or Win"</span>
    <span class="kw">return</span> None

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> getbeatswinregion(REGION):
    rh = <span class="dig">65</span>
    rx = REGION.getX()+<span class="dig">10</span>
    rw = REGION.getW()-<span class="dig">20</span>
    ry = REGION.getY()+REGION.getH()-<span class="dig">210</span> <span class="cmt">#200</span>
    newregion = Region(rx,ry,rw,rh)
    <span class="cmt">#newregion.highlight(1)</span>
    <span class="kw">return</span> newregion
<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> getbeatsmacregion(REGION):
    rh = <span class="dig">65</span>
    rx = REGION.getX()+<span class="dig">10</span>
    rw = REGION.getW()-<span class="dig">20</span>
    ry = REGION.getY()+REGION.getH()-<span class="dig">200</span>
    newregion = Region(rx,ry,rw,rh)
    <span class="cmt">#newregion.highlight(1)</span>
    <span class="kw">return</span> newregion

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> getmomentsregion(beatsregion):
    rh = <span class="dig">90</span>
    rx = beatsregion.getX()
    ry = beatsregion.getY()-<span class="dig">110</span>  <span class="cmt">#110</span>
    rw = beatsregion.getW()
    newregion = Region(rx,ry,rw,rh)
    <span class="cmt">#newregion.highlight(1)</span>
    <span class="kw">return</span> newregion
<span class="cmt">################################################</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">################################################</span>
<span class="kw">def</span> getmomentsfilename(png,duration,beatsdir,no_eval=False):
    rc= no_eval
    newname = <img src="_viewmoments_%d.png" /> % duration
    beats = png.replace(<img src=".png" />,newname)
    imgpath = os.path.join(beatsdir, beats)
    <span class="kw">if</span> os.path.isfile(imgpath):
        rc = True
        <span class="kw">print</span> <span class="str">"File Exists:%s"</span> % imgpath
    <span class="kw">return</span> rc,imgpath

<span class="kw">def</span> checkexclusivetests(msongs,png):
    rc=False
    <span class="kw">if</span> msongs.isexclusive(png):
        <span class="cmt">#check if png on list</span>
        rc=True
    <span class="kw">return</span> rc
<span class="cmt">################################################</span>
<span class="cmt">#</span>
<span class="cmt"># Example</span>
    <span class="cmt">#selectedmoments-Video_1-4_15sec_4cnt_song_RAINDOWN.png</span>
    <span class="cmt">#selectedmoments-Video_1-4_30sec_13cnt_song_RAINDOWN.png</span>
    <span class="cmt">#selectedmoments-Video_1-4_60sec_16cnt_song_RAINDOWN.png</span>
    <span class="cmt">#selectedmoments-Video_5-8_15sec_4cnt_song_RAINDOWN.png</span>
    <span class="cmt">#selectedmoments-Video_5-8_30sec_13cnt_song_RAINDOWN.png</span>
    <span class="cmt">#selectedmoments-Video_5-8_60sec_16cnt_song_RAINDOWN.png</span>
    <span class="cmt">#selectedmoments-Video_9-12_15sec_4cnt_song_RAINDOWN.png</span>
    <span class="cmt">#selectedmoments-Video_9-12_30sec_13cnt_song_RAINDOWN.png</span>
    <span class="cmt">#selectedmoments-Video_9-12_60sec_16cnt_song_RAINDOWN.png</span>
    <span class="cmt">#selectedmoments-Video_13-16_15sec_4cnt_song_RAINDOWN.png</span>
    <span class="cmt">#selectedmoments-Video_13-16_30sec_13cnt_song_RAINDOWN.png</span>
    <span class="cmt">#selectedmoments-Video_13-16_60sec_16cnt_song_RAINDOWN.png</span>

<span class="cmt"># checks all 18 expected files are found return True,False</span>
<span class="cmt"># return dict of all file paths found</span>
<span class="cmt"># return rc=True will process this png song</span>
<span class="cmt">################################################</span>
<span class="kw">def</span> getregressionfilelists(png,beatsdir):
    <span class="kw">global</span> d_report
    rc= False

    search = [<img src="_viewbeats_15.png" />,<img src="_viewbeats_30.png" />,<img src="_viewbeats_60.png" />,<img src="_viewmoments_15.png" />,<img src="_viewmoments_30.png" />,<img src="_viewmoments_60.png" />,<span class="str">"1-4_15"</span>,<span class="str">"1-4_30"</span>,<span class="str">"1-4_60"</span>,<span class="str">"5-8_15"</span>,<span class="str">"5-8_30"</span>,<span class="str">"5-8_60"</span>,<span class="str">"9-12_15"</span>,<span class="str">"9-12_30"</span>,<span class="str">"9-12_60"</span>,<span class="str">"13-16_15"</span>,<span class="str">"13-16_30"</span>,<span class="str">"13-16_60"</span>]
    flist=os.listdir(beatsdir)
    fsearch=[]
    bname = str(os.path.basename(png).split(<span class="str">'/'</span>)[-<span class="dig">1</span>].split(<span class="str">'.'</span>)[<span class="dig">0</span>])+<span class="str">"_"</span>
    <span class="kw">print</span> bname
    <span class="cmt">#make search item array</span>
    <span class="kw">for</span> item <span class="kw">in</span> search:
        <span class="kw">if</span> <span class="str">"viewbeats"</span> <span class="kw">in</span> item:
            fsearch.append(item)
        <span class="kw">elif</span> <span class="str">"viewmoments"</span> <span class="kw">in</span> item:
            fsearch.append(item)
        <span class="kw">else</span>:
            s1=<span class="str">"%s%ssec_"</span> % (<span class="str">"selectedmoments-Video_"</span>,item)
            fsearch.append(s1)
    found={}
    <span class="cmt">#iterate all files for match png and fsearch item and set the actual file name in fsearch</span>
    <span class="kw">for</span> item <span class="kw">in</span> flist:
        <span class="kw">if</span> (png <span class="kw">in</span> item) <span class="kw">or</span> (bname <span class="kw">in</span> item):
            <span class="kw">for</span> i <span class="kw">in</span> range(<span class="dig">0</span>,len(fsearch)):
                <span class="kw">if</span> fsearch[i] <span class="kw">in</span> item:
                    imgpath = os.path.join(beatsdir, item)
                    <span class="kw">if</span> os.path.isfile(imgpath):
                        <span class="kw">print</span> <span class="str">"key=%s - File Exists:%s"</span> % (fsearch[i],imgpath)
                        found[fsearch[i]]=imgpath
                    <span class="kw">else</span>:
                        <span class="kw">print</span> <span class="str">"Not exists:%s"</span> % imgpath


    <span class="kw">if</span> len(found)==<span class="dig">18</span>:
        rc=True
    <span class="cmt">#lets skip regression test songs already proccessed as passed</span>
    <span class="cmt">#will override rc=False from True to False if found as PASSED regression test</span>
    <span class="kw">if</span> d_report <span class="kw">and</span> <span class="str">"songs"</span> <span class="kw">in</span> d_report:
        <span class="kw">for</span> song <span class="kw">in</span> d_report[<span class="str">"songs"</span>]:
            <span class="kw">if</span> <span class="str">"png"</span> <span class="kw">in</span> song:
                <span class="kw">if</span> song[<span class="str">"png"</span>]==png:
                    <span class="kw">if</span> gda_utils.d_gda_settings[<span class="str">'exclusive_songs'</span>]==False:
                        <span class="kw">if</span> <span class="str">"PASSED"</span> <span class="kw">in</span> song:
                            <span class="kw">if</span> song[<span class="str">"PASSED"</span>]==<span class="str">"Song Regression Tests"</span>:
                                rc=False

                    <span class="kw">break</span>


    <span class="kw">return</span> rc,found

<span class="cmt">################################################</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">################################################</span>
<span class="kw">def</span> savemomentsscreenshot(region,imgpath,msg=<span class="str">"save moments screenshot"</span>):
    rc = False
    <span class="kw">print</span> <span class="str">"savemomentsscreenshot &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>
    found = False

    beatsr = region<span class="cmt">#getsongbeatsregion(region)</span>
    <span class="kw">if</span> <span class="kw">not</span> beatsr:
        <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
        <span class="kw">print</span> <span class="str">"FAILED savemomentsscreenshot region not found"</span>
        <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
        <span class="kw">print</span> <span class="str">"savemomentsscreenshot &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
        <span class="kw">return</span> False
    <span class="cmt">#newname = "_musicbeats_%d.png" % duration</span>
    <span class="cmt">#beats = png.replace(".png",newname)</span>
    beatsr.highlight(<span class="dig">1</span>)
    <span class="cmt">#wait(2)</span>

    <span class="cmt">#imagepath=ImagePath.getBundlePath()</span>
    <span class="cmt">#imagepath=imgdir</span>
    fpath = <span class="skw">capture</span>(beatsr)
    <span class="cmt">#print str(fpath)</span>
    <span class="kw">if</span> os.path.isfile(str(fpath)):
        <span class="kw">print</span> <span class="str">"%s &gt;&gt;&gt; MOVE &gt;&gt;&gt; \n%s"</span> % (fpath,imgpath)
        <span class="cmt">#imgpath = os.path.join(imagepath, beats)        </span>
        <span class="kw">try</span>:
            shutil.move(str(fpath), str(imgpath))
        <span class="kw">except</span>:
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
            <span class="kw">print</span> <span class="str">"FAILED shutil.move: file not found\n%s"</span> % str(imgpath)
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
        <span class="skw">wait</span>(<span class="dig">5.0</span>)
        <span class="kw">print</span> msg
        <span class="kw">if</span> os.path.isfile(imgpath):
            <span class="kw">print</span> <span class="str">"SAVED: %s"</span> % imgpath
            rc = True
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
            <span class="kw">print</span> <span class="str">"FAILED file not found: \n%s"</span> % imgpath
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
        <span class="kw">print</span> <span class="str">"FAILED capture png: file not found"</span>
        <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
    <span class="kw">print</span> <span class="str">"savemomentsscreenshot &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc
<span class="cmt">################################################</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">################################################</span>
<span class="kw">def</span> verifymomentsscreenshot(region,imgpath,msg=<span class="str">"verify moments screenshot"</span>,similarity=<span class="dig">0.80</span>):
    rc = False
    <span class="kw">print</span> <span class="str">"verifymomentsscreenshot &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>

    beatsr = region.grow(<span class="dig">10</span>)<span class="cmt">#getbeatsregion(region)</span>
    <span class="kw">if</span> <span class="kw">not</span> beatsr:
        <span class="kw">print</span> <span class="str">"FAILED verifymomentsscreenshot region not found"</span>
        <span class="kw">print</span> <span class="str">"verifymomentsscreenshot &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
        <span class="kw">return</span> False
    <span class="cmt">#newname = "_musicbeats_%d.png" % duration</span>
    <span class="cmt">#beats = png.replace(".png",newname)</span>
    beatsr.highlight(<span class="dig">1</span>)
    <span class="cmt">#wait(2)</span>

    <span class="cmt">#imagepath=ImagePath.getBundlePath()</span>
    <span class="cmt">#imagepath=imgdir</span>
    <span class="cmt">#fpath = capture(beatsr)</span>
    rc,fmatch=gda_utils.verifyregion(beatsr,imgpath,similarity)
    score=<span class="dig">0</span>
    <span class="cmt">#rc, fmatch = gda_utils.compare_img1path_img2path(fpath,imgpath,0.69)</span>
    <span class="kw">if</span> fmatch:
        score=<span class="str">"%.2f"</span> % fmatch.getScore()
        <span class="kw">print</span> <span class="str">"verifymomentsscreenshot: Similarity score=%s"</span> % score
    <span class="kw">if</span> rc:
        <span class="kw">print</span> <span class="str">"PASSED: %s"</span> % msg
        rc = True
        fname=<span class="str">"PASSED-%s_%s"</span> % (msg,os.path.basename(imgpath))
        gda_utils.ScreenShot(beatsr,fname,<span class="str">"score-"</span>+str(score))
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"FAILED: %s"</span> % msg
        beatsr.highlight(<span class="dig">10</span>)
        fname=<span class="str">"FAILED-%s_%s"</span> % (msg,os.path.basename(imgpath))
        gda_utils.ScreenShot(beatsr,fname,<span class="str">"score-"</span>+str(score))
    <span class="kw">print</span> <span class="str">"verifymomentsscreenshot &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc

<span class="cmt">################################################</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">################################################</span>
<span class="kw">def</span> getbeatsfilename(png,duration,beatsdir,no_eval=False):
    <span class="kw">print</span> <span class="str">"getbeatsfilename &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>
    rc = no_eval
    newname = <img src="_viewbeats_%d.png" /> % duration
    beats = str(png).replace(<img src=".png" />,newname)
    imgpath = os.path.join(beatsdir, beats)
    <span class="kw">if</span> os.path.isfile(imgpath):
        rc = True
        <span class="kw">print</span> <span class="str">"File Exists:%s"</span> % imgpath
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"FAILED:%s"</span> % imgpath
    <span class="kw">print</span> <span class="str">"getbeatsfilename &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc,imgpath

<span class="cmt">################################################</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">################################################</span>
<span class="kw">def</span> savebeatsscreenshot(region,imgpath,msg=<span class="str">"save beats screenshot"</span>):
    rc = False
    <span class="kw">print</span> <span class="str">"savebeatsscreenshot &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>
    found = False

    beatsr = region<span class="cmt">#getbeatsregion(region)</span>
    <span class="kw">if</span> <span class="kw">not</span> beatsr:
        <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
        <span class="kw">print</span> <span class="str">"FAILED savebeatsscreenshot region not found"</span>
        <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
        <span class="kw">print</span> <span class="str">"savebeatsscreenshot &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
        <span class="kw">return</span> False
    <span class="cmt">#newname = "_musicbeats_%d.png" % duration</span>
    <span class="cmt">#beats = png.replace(".png",newname)</span>
    beatsr.highlight(<span class="dig">1</span>)
    <span class="cmt">#wait(2)</span>

    <span class="cmt">#imagepath=ImagePath.getBundlePath()</span>
    <span class="cmt">#imagepath=imgdir</span>
    fpath = <span class="skw">capture</span>(beatsr)
    <span class="cmt">#print str(fpath)</span>
    <span class="kw">if</span> os.path.isfile(str(fpath)):
        <span class="kw">print</span> <span class="str">"%s &gt;&gt;&gt; MOVE &gt;&gt;&gt; \n%s"</span> % (fpath,imgpath)
        <span class="cmt">#imgpath = os.path.join(imagepath, beats)</span>
        <span class="kw">try</span>:
            shutil.move(str(fpath), str(imgpath))
        <span class="kw">except</span>:
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
            <span class="kw">print</span> <span class="str">"FAILED shutil.move: file not found\n%s"</span> % str(imgpath)
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
        <span class="skw">wait</span>(<span class="dig">2</span>)
        <span class="kw">print</span> msg
        <span class="kw">if</span> os.path.isfile(imgpath):
            <span class="kw">print</span> <span class="str">"SAVED: %s"</span> % imgpath
            rc = True
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
            <span class="kw">print</span> <span class="str">"FAILED file not found: %s"</span> % imgpath
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>


    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
        <span class="kw">print</span> <span class="str">"FAILED capture png: file not found"</span>
        <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!"</span>
    <span class="kw">print</span> <span class="str">"savebeatsscreenshot &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc
<span class="cmt">################################################</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">################################################</span>
<span class="kw">def</span> verifybeatsscreenshot(region,imgpath,msg=<span class="str">"verify beats screenshot"</span>,similarity=<span class="dig">0.80</span>):
    rc = False
    <span class="kw">print</span> <span class="str">"verifybeatsscreenshot &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>

    beatsr = region.grow(<span class="dig">10</span>) <span class="cmt">#getbeatsregion(region)</span>
    <span class="kw">if</span> <span class="kw">not</span> beatsr:
        <span class="kw">print</span> <span class="str">"FAILED verifybeatsscreenshot region not found"</span>
        <span class="kw">print</span> <span class="str">"verifybeatsscreenshot &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
        <span class="kw">return</span> False
    <span class="cmt">#newname = "_musicbeats_%d.png" % duration</span>
    <span class="cmt">#beats = png.replace(".png",newname)</span>
    beatsr.highlight(<span class="dig">1</span>)
    <span class="cmt">#wait(2)</span>

    <span class="cmt">#imagepath=ImagePath.getBundlePath()</span>
    <span class="cmt">#imagepath=imgdir</span>
    <span class="cmt">#fpath = capture(beatsr)</span>
    rc,fmatch=gda_utils.verifyregion(beatsr,imgpath,similarity)
    <span class="cmt">#rc, fmatch = gda_utils.compare_img1path_img2path(fpath,imgpath,0.69)</span>
    score=<span class="dig">0</span>
    <span class="kw">if</span> fmatch:
        score=<span class="str">"%.2f"</span> % fmatch.getScore()
        <span class="kw">print</span> <span class="str">"verifybeatsscreenshot: Similarity score=%s"</span> % score
    <span class="kw">if</span> rc:
        <span class="kw">print</span> <span class="str">"PASSED: %s"</span> % msg
        fname=<span class="str">"PASSED-%s_%s"</span> % (msg,os.path.basename(imgpath))
        gda_utils.ScreenShot(beatsr,fname,<span class="str">"score-"</span>+str(score))
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"FAILED: %s"</span> % msg
        beatsr.highlight(<span class="dig">10</span>)
        fname=<span class="str">"FAILED-%s_%s"</span> % (msg,os.path.basename(imgpath))
        gda_utils.ScreenShot(beatsr,fname,<span class="str">"score-"</span>+str(score))

    <span class="kw">print</span> <span class="str">"verifybeatsscreenshot &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc
<span class="cmt">################################################</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">################################################</span>
<span class="kw">def</span> verify_all_moment_selection_regions(REGION,d_filelist,momentcount,duration,song,imgdir):
    <span class="kw">print</span> <span class="str">"verify_all_moment_selection_regions &gt;&gt;&gt;&gt;&gt;&gt;:%d - %s\n%s"</span> % (duration,song,imgdir)
    rc = False
    tcount=<span class="dig">0</span>
    tests={}
    f1=None

    p1 = Pattern(<img src="editor_img_1-4.png" />).similar(<span class="dig">0.80</span>) <span class="cmt"># editor_img_1-4</span>
    k1 = <span class="str">"selectedmoments-Video_1-4_%isec_"</span> % duration  <span class="cmt">#selectedmoments-Video_1-4_60sec_</span>

    p2 = Pattern(<img src="editor_img_5-8.png" />).similar(<span class="dig">0.80</span>) <span class="cmt"># editor_img_5-8</span>
    k2 = <span class="str">"selectedmoments-Video_5-8_%isec_"</span> % duration

    p3 = Pattern(<img src="editor_img_9-12.png" />).similar(<span class="dig">0.80</span>) <span class="cmt"># editor_img_9-12</span>
    k3 = <span class="str">"selectedmoments-Video_9-12_%isec_"</span> % duration

    p4 = Pattern(<img src="editor_img_13-16.png" />).similar(<span class="dig">0.80</span>) <span class="cmt"># editor_img_13-16</span>
    k4 = <span class="str">"selectedmoments-Video_13-16_%isec_"</span> % duration

    sdur1=str(duration)
    tests={}
    <span class="cmt">#tests[sdur1]={}</span>
    tests[<span class="str">"dir"</span>]=imgdir
    tests[<span class="str">"duration"</span>]=sdur1
    smomentc1=str(momentcount)
    tests[<span class="str">"count"</span>]=smomentc1
    score=<span class="dig">0</span>
    scorelist=<span class="str">"SCORES:"</span>
    <span class="kw">print</span> <span class="str">"TEST: %s"</span> % str(p1)
    r1 = gda_utils.EXISTS3(<span class="str">"CREATE"</span>, <span class="str">"4VIDEOS"</span>, p1)
    <span class="kw">if</span> r1:
        r1=r1.grow(<span class="dig">10</span>)
        r1.highlight(<span class="dig">1</span>)
        <span class="kw">print</span> <span class="str">"Found region: %s - %s"</span> % (k1,song)
        testname1=<span class="str">""</span>
        <span class="kw">if</span> k1 <span class="kw">in</span> d_filelist:
            testname1=os.path.basename(d_filelist[k1])
            <span class="kw">print</span> testname1
            tests[<span class="str">"Video_1-4"</span>]={}
            tests[<span class="str">"Video_1-4"</span>][<span class="str">"testpng"</span>]=testname1
            tests[<span class="str">"Video_1-4"</span>][<span class="str">"status"</span>]=<span class="str">"FAILED"</span>
            tests[<span class="str">"Video_1-4"</span>][<span class="str">"score"</span>]=-<span class="dig">1</span>
            msg = <span class="str">"VERIFY MOMENTS SELECTIONS: %s"</span> % testname1
            <span class="kw">print</span> msg
            rc,m_match = gda_utils.verifyregion(r1,d_filelist[k1],<span class="dig">0.80</span>)
            <span class="kw">if</span> rc <span class="kw">and</span> m_match:
                score=<span class="str">"%.2f"</span> % m_match.getScore()
                msg= <span class="str">"PASSED-SCORE=%s - %s"</span> % (score,msg)
                <span class="kw">print</span> msg
                tests[<span class="str">"Video_1-4"</span>][<span class="str">"status"</span>]=<span class="str">"PASSED"</span>
                tests[<span class="str">"Video_1-4"</span>][<span class="str">"score"</span>]=score
                tcount+=<span class="dig">1</span>
                gda_utils.ScreenShot(r1,<span class="str">""</span>,msg)
            <span class="kw">else</span>:
                r1.highlight(<span class="dig">10</span>)
                msg=<span class="str">"FAILED-%s"</span> % msg
                <span class="kw">print</span> msg
                gda_utils.ScreenShot(r1,<span class="str">""</span>,msg)
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"Error: invalid path in d_filelist key=%s"</span> % k1
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"FAILED: %s"</span> % str(p1)

    <span class="kw">print</span> <span class="str">"TEST: %s"</span> % str(p2)
    r2 = gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"4VIDEOS"</span>,p2)
    <span class="kw">if</span> r2:
        <span class="kw">print</span> <span class="str">"Found region: %s - %s"</span> % (k2,song)
        r2=r2.grow(<span class="dig">10</span>)
        r2.highlight(<span class="dig">1</span>)
        testname1=<span class="str">""</span>
        <span class="kw">if</span> k2 <span class="kw">in</span> d_filelist:
            testname2=os.path.basename(d_filelist[k2])
            tests[<span class="str">"Video_5-8"</span>]={}
            tests[<span class="str">"Video_5-8"</span>][<span class="str">"testpng"</span>]=testname2
            tests[<span class="str">"Video_5-8"</span>][<span class="str">"status"</span>]=<span class="str">"FAILED"</span>
            tests[<span class="str">"Video_5-8"</span>][<span class="str">"score"</span>]=-<span class="dig">1</span>
            msg=<span class="str">"VERIFY MOMENTS SELECTIONS: %s"</span> % testname2
            <span class="kw">print</span> msg
            rc,m_match = gda_utils.verifyregion(r2,d_filelist[k2],<span class="dig">0.80</span>)
            <span class="kw">if</span> rc <span class="kw">and</span> m_match:
                score=<span class="str">"%.2f"</span> % m_match.getScore()
                msg= <span class="str">"PASSED-SCORE=%s - %s"</span> % (score,msg)
                <span class="kw">print</span> msg
                tests[<span class="str">"Video_5-8"</span>][<span class="str">"status"</span>]=<span class="str">"PASSED"</span>
                tests[<span class="str">"Video_5-8"</span>][<span class="str">"score"</span>]=score
                tcount+=<span class="dig">1</span>
                gda_utils.ScreenShot(r2,<span class="str">""</span>,msg)
            <span class="kw">else</span>:
                r2.highlight(<span class="dig">10</span>)
                msg=<span class="str">"FAILED-%s"</span> % msg
                <span class="kw">print</span> msg
                gda_utils.ScreenShot(r2,<span class="str">""</span>,msg)
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"Error: invalid path in d_filelist key=%s"</span> % k2
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"FAILED: %s"</span> % str(p2)

    <span class="kw">print</span> <span class="str">"TEST: %s"</span> % str(p3)
    r3 = gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"4VIDEOS"</span>,p3)
    <span class="kw">if</span> r3:
        <span class="kw">print</span> <span class="str">"Found region: %s - %s"</span> % (k3,song)
        r31=r3.grow(<span class="dig">10</span>)
        r3.highlight(<span class="dig">1</span>)
        testname1=<span class="str">""</span>
        <span class="kw">if</span> k3 <span class="kw">in</span> d_filelist:
            testname3=os.path.basename(d_filelist[k3])
            tests[<span class="str">"Video_9-12"</span>]={}
            tests[<span class="str">"Video_9-12"</span>][<span class="str">"testpng"</span>]=testname3
            tests[<span class="str">"Video_9-12"</span>][<span class="str">"status"</span>]=<span class="str">"FAILED"</span>
            tests[<span class="str">"Video_9-12"</span>][<span class="str">"score"</span>]=-<span class="dig">1</span>
            msg=<span class="str">"VERIFY MOMENTS SELECTIONS: %s"</span> % testname3
            rc,m_match = gda_utils.verifyregion(r3,d_filelist[k3],<span class="dig">0.80</span>)
            <span class="kw">if</span> rc <span class="kw">and</span> m_match:
                score=<span class="str">"%.2f"</span> % m_match.getScore()
                msg= <span class="str">"PASSED-SCORE=%s - %s"</span> % (score,msg)
                <span class="kw">print</span> msg
                tests[<span class="str">"Video_9-12"</span>][<span class="str">"status"</span>]=<span class="str">"PASSED"</span>
                tests[<span class="str">"Video_9-12"</span>][<span class="str">"score"</span>]=score
                tcount+=<span class="dig">1</span>
                gda_utils.ScreenShot(r3,<span class="str">""</span>,msg)
            <span class="kw">else</span>:
                r3.highlight(<span class="dig">10</span>)
                msg=<span class="str">"FAILED-%s"</span> % msg
                <span class="kw">print</span> msg
                gda_utils.ScreenShot(r3,<span class="str">""</span>,msg)
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"Error: invalid path in d_filelist key=%s"</span> % k3
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"FAILED: %s"</span> % str(p3)

    <span class="kw">print</span> <span class="str">"TEST: %s"</span> % str(p4)
    r4 = gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"4VIDEOS"</span>,p4)
    <span class="kw">if</span> r4:
        <span class="kw">print</span> <span class="str">"Found region: %s - %s"</span> % (k4,song)
        r4=r4.grow(<span class="dig">10</span>)
        r4.highlight(<span class="dig">1</span>)
        testname1=<span class="str">""</span>
        <span class="kw">if</span> k4 <span class="kw">in</span> d_filelist:
            testname4=os.path.basename(d_filelist[k4])
            tests[<span class="str">"Video_13-16"</span>]={}
            tests[<span class="str">"Video_13-16"</span>][<span class="str">"testpng"</span>]=testname4
            tests[<span class="str">"Video_13-16"</span>][<span class="str">"status"</span>]=<span class="str">"FAILED"</span>
            tests[<span class="str">"Video_13-16"</span>][<span class="str">"score"</span>]=-<span class="dig">1</span>
            msg=<span class="str">"VERIFY MOMENTS SELECTIONS: %s"</span> % testname4
            rc,m_match = gda_utils.verifyregion(r4,d_filelist[k4],<span class="dig">0.80</span>)
            <span class="kw">if</span> rc <span class="kw">and</span> m_match:
                score=<span class="str">"%.2f"</span> % m_match.getScore()
                msg= <span class="str">"PASSED-SCORE=%s - %s"</span> % (score,msg)
                <span class="kw">print</span> msg
                tests[<span class="str">"Video_13-16"</span>][<span class="str">"status"</span>]=<span class="str">"PASSED"</span>
                tests[<span class="str">"Video_13-16"</span>][<span class="str">"score"</span>]=score
                tcount+=<span class="dig">1</span>
                gda_utils.ScreenShot(r4,<span class="str">""</span>,msg)
            <span class="kw">else</span>:
                r4.highlight(<span class="dig">10</span>)
                msg=<span class="str">"FAILED-%s"</span> % msg
                <span class="kw">print</span> msg
                gda_utils.ScreenShot(r4,<span class="str">""</span>,msg)
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"Error: invalid path in d_filelist key=%s"</span> % k4
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"FAILED: %s"</span> % str(p4)

    <span class="kw">if</span> tcount==<span class="dig">4</span>:
        <span class="cmt">#All passed</span>
        rc = True
        msg= <span class="str">"PASSED-All: %s"</span> % song
        <span class="kw">print</span> msg
        gda_utils.ScreenShot(REGION,<span class="str">""</span>,msg)
    <span class="kw">else</span>: <span class="cmt">#failed</span>
        rc = False
        msg= <span class="str">"FAILED-%d-of-4:-%s"</span> % (tcount,song)
        <span class="kw">print</span> msg
        gda_utils.ScreenShot(REGION,<span class="str">""</span>,msg)

    <span class="kw">print</span> <span class="str">"verify_all_moment_selection_regions &lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc,tests


<span class="cmt">######################################</span>
<span class="cmt"># After all moment selections done, grab screenshots of the individual video regions</span>
<span class="cmt"># This will be the input validations to each song. </span>
<span class="cmt"># if this does not pass then the beats &amp; moments thumbs are probably invalid too</span>
<span class="cmt"># We need this for cross validation for bugs</span>
<span class="cmt"># 1. find the four video regions</span>
<span class="cmt"># 2. define appropriate region file names with png</span>
<span class="cmt"># 3. </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> save_all_moment_selection_regions(REGION,momentcount,duration,song,imgdir):
    <span class="kw">print</span> <span class="str">"save_all_moment_selection_regions &gt;&gt;&gt;&gt;&gt;&gt;:%d - %s"</span> % (duration,song)
    rc = False
    tcount=<span class="dig">0</span>
    tests={}
    p1 = Pattern(<img src="editor_img_1-4.png" />).similar(<span class="dig">0.80</span>) <span class="cmt"># editor_img_1-4</span>
    r1 = gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"4VIDEOS"</span>,p1)
    p2 = Pattern(<img src="editor_img_5-8.png" />).similar(<span class="dig">0.80</span>) <span class="cmt"># editor_img_5-8</span>
    r2 = gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"4VIDEOS"</span>,p2)
    p3 = Pattern(<img src="editor_img_9-12.png" />).similar(<span class="dig">0.80</span>) <span class="cmt"># editor_img_9-12</span>
    r3 = gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"4VIDEOS"</span>,p3)
    p4 = Pattern(<img src="editor_img_13-16.png" />).similar(<span class="dig">0.80</span>) <span class="cmt"># editor_img_13-16</span>
    r4 = gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"4VIDEOS"</span>,p4)

    sdur1=str(duration)
    tests={}
    <span class="cmt">#tests[sdur1]={}</span>
    tests[<span class="str">"dir"</span>]=imgdir
    tests[<span class="str">"duration"</span>]=sdur1
    smomentc1=str(momentcount)
    tests[<span class="str">"count"</span>]=smomentc1

    <span class="kw">if</span> r1:
        testname1=<span class="str">"selectedmoments-Video_1-4_%dsec_%dcnt_%s"</span> % (duration,momentcount,song)
        path1=os.path.join(imgdir,testname1)
        tests[<span class="str">"Video_1-4"</span>]={}
        tests[<span class="str">"Video_1-4"</span>][<span class="str">"testpng"</span>]=testname1
        tests[<span class="str">"Video_1-4"</span>][<span class="str">"status"</span>]=<span class="str">"FAILED"</span>
        msg=<span class="str">"SAVE MOMENTS SELECTIONS: %s"</span> % testname1
        <span class="kw">if</span> savebeatsscreenshot(r1,path1,msg):
            <span class="kw">print</span> <span class="str">"PASSED: %s"</span> % msg
            tests[<span class="str">"Video_1-4"</span>][<span class="str">"status"</span>]=<span class="str">"PASSED"</span>
            tcount+=<span class="dig">1</span>
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"FAILED: %s"</span> % msg
            r1.highlight(<span class="dig">5</span>)

    <span class="kw">if</span> r2:
        testname2=<span class="str">"selectedmoments-Video_5-8_%dsec_%dcnt_%s"</span> % (duration,momentcount,song)
        path1=os.path.join(imgdir,testname2)
        tests[<span class="str">"Video_5-8"</span>]={}
        tests[<span class="str">"Video_5-8"</span>][<span class="str">"testpng"</span>]=testname2
        tests[<span class="str">"Video_5-8"</span>][<span class="str">"status"</span>]=<span class="str">"FAILED"</span>
        msg=<span class="str">"SAVE MOMENTS SELECTIONS: %s"</span> % testname2
        <span class="kw">if</span> savebeatsscreenshot(r2,path1,msg):
            <span class="kw">print</span> <span class="str">"PASSED: %s"</span> % msg
            tests[<span class="str">"Video_5-8"</span>][<span class="str">"status"</span>]=<span class="str">"PASSED"</span>
            tcount+=<span class="dig">1</span>
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"FAILED: %s"</span> % msg
            r2.highlight(<span class="dig">5</span>)

    <span class="kw">if</span> r3:
        testname3=<span class="str">"selectedmoments-Video_9-12_%dsec_%dcnt_%s"</span> % (duration,momentcount,song)
        path1=os.path.join(imgdir,testname3)
        tests[<span class="str">"Video_9-12"</span>]={}
        tests[<span class="str">"Video_9-12"</span>][<span class="str">"testpng"</span>]=testname3
        tests[<span class="str">"Video_9-12"</span>][<span class="str">"status"</span>]=<span class="str">"FAILED"</span>
        msg=<span class="str">"SAVE MOMENTS SELECTIONS: %s"</span> % testname3
        <span class="kw">if</span> savebeatsscreenshot(r3,path1,msg):
            <span class="kw">print</span> <span class="str">"PASSED: %s"</span> % msg
            tests[<span class="str">"Video_9-12"</span>][<span class="str">"status"</span>]=<span class="str">"PASSED"</span>
            tcount+=<span class="dig">1</span>
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"FAILED: %s"</span> % msg
            r3.highlight(<span class="dig">5</span>)
    <span class="kw">if</span> r4:
        testname4=<span class="str">"selectedmoments-Video_13-16_%dsec_%dcnt_%s"</span> % (duration,momentcount,song)
        path1=os.path.join(imgdir,testname4)
        tests[<span class="str">"Video_13-16"</span>]={}
        tests[<span class="str">"Video_13-16"</span>][<span class="str">"testpng"</span>]=testname4
        tests[<span class="str">"Video_13-16"</span>][<span class="str">"status"</span>]=<span class="str">"FAILED"</span>
        msg=<span class="str">"SAVE MOMENTS SELECTIONS: %s"</span> % testname4
        <span class="kw">if</span> savebeatsscreenshot(r4,path1,msg):
            <span class="kw">print</span> <span class="str">"PASSED: %s"</span> % msg
            tests[<span class="str">"Video_13-16"</span>][<span class="str">"status"</span>]=<span class="str">"PASSED"</span>
            tcount+=<span class="dig">1</span>
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"FAILED: %s"</span> % msg
            r4.highlight(<span class="dig">5</span>)

    <span class="kw">if</span> tcount==<span class="dig">4</span>:
        <span class="cmt">#All passed</span>
        rc = True
        <span class="kw">print</span> <span class="str">"All 4 PASSED: %s"</span> % song
    <span class="kw">else</span>: <span class="cmt">#failed</span>
        <span class="kw">print</span> <span class="str">"%d of 4 FAILED: %s"</span> % (tcount,song)
    <span class="kw">print</span> <span class="str">"save_all_moment_selection_regions &lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc,tests

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt">#</span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> recordmomentsandbeats(REGION,d_song,png,duration,momentcount):
    <span class="kw">global</span> d_report
    sdur=<span class="str">"%sSecs"</span> % str(duration)
    <span class="kw">if</span> <span class="kw">not</span> png:
        <span class="kw">return</span> False,d_song
    beatsregion = gda_utils.getregion(<span class="str">"CREATE"</span>,<span class="str">"BEATS"</span>) <span class="cmt">#getbeatsregion(REGION)</span>
    momentsregion= gda_utils.getregion(<span class="str">"CREATE"</span>,<span class="str">"MOMENTS"</span>) <span class="cmt">#getmomentsregion(beatsregion)#need the beats region as reference</span>
    <span class="cmt">#imgdir = os.path.join("/Automation", "gda_music_images")</span>
    imgdir = gda_utils.d_gda_settings[<span class="str">"gda_music_images"</span>]
    tests=None
    rc,tests=save_all_moment_selection_regions(REGION,momentcount,duration,png,imgdir)
    <span class="kw">print</span> sdur
    <span class="kw">if</span> rc <span class="kw">and</span> tests:
        <span class="kw">if</span> <span class="str">"regression_moments_select"</span> <span class="kw">not</span> <span class="kw">in</span> d_song:
            d_song[<span class="str">"regression_moments_select"</span>]={}
        d_song[<span class="str">"regression_moments_select"</span>][sdur]={}
        d_song[<span class="str">"regression_moments_select"</span>][sdur]=tests
    <span class="kw">else</span>:
        <span class="kw">if</span> tests:
            <span class="kw">if</span> <span class="str">"regression_moments_select"</span> <span class="kw">not</span> <span class="kw">in</span> d_song:
                d_song[<span class="str">"regression_moments_select"</span>]={}
            d_song[<span class="str">"regression_moments_select"</span>][sdur]={}
            d_song[<span class="str">"regression_moments_select"</span>][sdur]=tests
        <span class="kw">print</span> <span class="str">"FAILED SKIPPING BEATS &amp; MOMENTS THUMBS REGION CAPTURES"</span>
        <span class="kw">return</span> False,d_song

    rc,imgpath = getbeatsfilename(png,duration,imgdir,True)

    <span class="kw">if</span> <span class="str">"regression_beats"</span> <span class="kw">not</span> <span class="kw">in</span> d_song:
        d_song[<span class="str">"regression_beats"</span>]={}
    d_song[<span class="str">"regression_beats"</span>][sdur]={}
    d_song[<span class="str">"regression_beats"</span>][sdur][<span class="str">"name"</span>]=<span class="str">"record-beats-%s_%d"</span> % (png,duration)
    d_song[<span class="str">"regression_beats"</span>][sdur][<span class="str">"path"</span>]=imgpath
    d_song[<span class="str">"regression_beats"</span>][sdur][<span class="str">"status"</span>]=<span class="str">"No Test"</span>
    <span class="kw">if</span> rc <span class="kw">and</span> savebeatsscreenshot(beatsregion,imgpath):
        d_song[<span class="str">"regression_beats"</span>][sdur][<span class="str">"status"</span>]=<span class="str">"PASSED"</span>
        rc,imgpath = getmomentsfilename(png,duration,imgdir,True)
        <span class="kw">if</span> <span class="str">"regression_story"</span> <span class="kw">not</span> <span class="kw">in</span> d_song:
            d_song[<span class="str">"regression_story"</span>]={}
        d_song[<span class="str">"regression_story"</span>][sdur]={}
        d_song[<span class="str">"regression_story"</span>][sdur][<span class="str">"name"</span>]=<span class="str">"record-moments-%s_%d"</span> % (png,duration)
        <span class="cmt">#d_song["regression_story"][sdur]["png"]=png</span>
        <span class="cmt">#d_song["regression_story"][sdur]["duration"]=duration</span>
        d_song[<span class="str">"regression_story"</span>][sdur][<span class="str">"path"</span>]=imgpath
        d_song[<span class="str">"regression_story"</span>][sdur][<span class="str">"status"</span>]=<span class="str">"No Test"</span>
        <span class="kw">if</span> rc <span class="kw">and</span> savemomentsscreenshot(momentsregion,imgpath):
            d_song[<span class="str">"regression_story"</span>][sdur][<span class="str">"status"</span>]=<span class="str">"PASSED"</span>
            <span class="kw">return</span> True,d_song
        <span class="kw">else</span>:
            d_song[<span class="str">"regression_story"</span>][sdur][<span class="str">"status"</span>]=<span class="str">"FAILED"</span>
            <span class="kw">print</span> <span class="str">"FAILED: to savemomentsscreenshot %s"</span> % imgpath
    <span class="kw">else</span>:
        d_song[<span class="str">"regression_beats"</span>][sdur][<span class="str">"status"</span>]=<span class="str">"FAILED"</span>
        <span class="kw">print</span> <span class="str">"FAILED: to savebeatsscreenshot %s"</span> % imgpath
    <span class="kw">return</span> False, d_song

<span class="cmt">######################################</span>
<span class="cmt"># verify all four moments selections </span>
<span class="cmt"># if passed, then verify beats and story graph</span>
<span class="cmt"># test results update into d_song</span>
<span class="cmt"># d_filelist list of all the png imge files for verification of the given png</span>
<span class="cmt"># d_song dict is the test report</span>
<span class="cmt">######################################</span>
<span class="kw">def</span> verifymomentsandbeats(REGION,d_song,d_filelist,png,duration,momentcount):
    <span class="kw">print</span> <span class="str">"verifymomentsandbeats &gt;&gt;&gt;&gt;&gt;&gt;"</span>
    rc=False
    d_song.pop(<span class="str">"PASSED"</span>,None)
    msg=<span class="str">""</span>
    <span class="kw">if</span> <span class="kw">not</span> png:
        msg=<span class="str">"no png file"</span>
        <span class="kw">print</span> <span class="str">"verifymomentsandbeats &lt;&lt;&lt;&lt;&lt;&lt;&lt; %s"</span> % msg
        <span class="kw">return</span> False,d_song,msg
    beatsregion = gda_utils.getregion(<span class="str">"CREATE"</span>,<span class="str">"BEATS"</span>) <span class="cmt">#beatsregion = getbeatsregion(REGION)</span>
    momentsregion= gda_utils.getregion(<span class="str">"CREATE"</span>,<span class="str">"MOMENTS"</span>) <span class="cmt">#momentsregion=getmomentsregion(beatsregion)#need the beats region as reference</span>
    <span class="cmt">#imgdir = os.path.join("/Automation", "gda_music_images")</span>
    imgdir = gda_utils.d_gda_settings[<span class="str">"gda_music_images"</span>]
    rc=verify_all_moment_selection_regions(REGION,d_filelist,momentcount,duration,png,imgdir)
    <span class="kw">if</span> rc:
        rc,imgpath = getbeatsfilename(png,duration,imgdir)
        <span class="kw">if</span> rc <span class="kw">and</span> verifybeatsscreenshot(beatsregion,imgpath):
            rc,imgpath = getmomentsfilename(png,duration,imgdir)
            <span class="kw">if</span> rc <span class="kw">and</span> verifymomentsscreenshot(momentsregion,imgpath):
                d_song.pop(<span class="str">"FAILED"</span>,None)
                msg=<span class="str">"verifymomentsandbeats_%i"</span> % duration
                d_song[<span class="str">"PASSED"</span>]=msg
                <span class="kw">print</span> <span class="str">"PASSED verifymomentsandbeats:%s"</span> % d_song[<span class="str">"PASSED"</span>]
                gda_utils.ScreenShot(REGION,msg,<span class="str">"T"</span>+png+<span class="str">"-PASS"</span>)
                rc = True
            <span class="kw">else</span>:
                rc = False
                msg= <span class="str">"FAILED: verifymomentsscreenshot %i"</span> % duration
                d_song[<span class="str">"FAILED"</span>]=msg
                gda_utils.ScreenShot(REGION,msg,<span class="str">"T"</span>+png+<span class="str">"-FAIL"</span>)
        <span class="kw">else</span>:
            rc = False
            msg=<span class="str">"verifybeatsscreenshot_%i"</span> % duration
            d_song[<span class="str">"FAILED"</span>]=msg
            <span class="kw">print</span> <span class="str">"FAILED verifymomentsandbeats: %s"</span> % d_song[<span class="str">"FAILED"</span>]
            gda_utils.ScreenShot(REGION,msg,<span class="str">"T"</span>+png+<span class="str">"-FAIL"</span>)
    <span class="kw">else</span>:
        rc = False
        msg=<span class="str">"verify_all_moment_selection_regions %i %i"</span> % (duration,momentcount)
        d_song[<span class="str">"FAILED"</span>]=msg
        <span class="kw">print</span> <span class="str">"FAILED verifymomentsandbeats: %s"</span> % d_song[<span class="str">"FAILED"</span>]
        gda_utils.ScreenShot(REGION,msg,<span class="str">"T"</span>+png+<span class="str">"-FAIL"</span>)
    <span class="kw">print</span> <span class="str">"verifymomentsandbeats &lt;&lt;&lt;&lt;&lt;&lt;&lt; %s"</span> % png
    <span class="kw">return</span> rc, d_song, msg

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> evalstory_60sec(REGION,moments_png=None, beats_png=None):
    gda_utils.CLICK(REGION,Pattern(<img src="editor_btn_PREVIEW.png" />).similar(<span class="dig">0.98</span>)) <span class="cmt"># editor_btn_PREVIEW.png</span>
    <span class="skw">wait</span>(<span class="dig">60</span>)
    gda_utils.WAIT(REGION,Pattern(<img src="editor_btn_PREVIEW.png" />).similar(<span class="dig">0.98</span>),<span class="dig">70</span>) <span class="cmt"># editor_btn_PREVIEW.png</span>



    <span class="kw">if</span> <span class="kw">not</span> moments_png:
        gda_utils.FIND(REGION,Pattern(<img src="create_img_storymoments-riseup-60s.png" />).exact()) <span class="cmt"># create_img_storyhilites-riseup-60s</span>
    <span class="kw">if</span> <span class="kw">not</span> beats_png:
        gda_utils.FIND(REGION,Pattern(<img src="create_img_storymusicbeat-riseup-60s.png" />).similar(<span class="dig">0.98</span>)) <span class="cmt"># create_img_storymusicbeat-riseup-60s</span>


<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> play_preview(duration):
    gda_utils.CLICK3(<span class="str">"CREATE"</span>,<span class="str">"BOTTOM"</span>,Pattern(<img src="editor_btn_PREVIEW.png" />).similar(<span class="dig">0.80</span>)) <span class="cmt"># editor_btn_PREVIEW.png</span>
    <span class="skw">wait</span>(duration+<span class="dig">10</span>)
    mouseMove(<span class="dig">0</span>,<span class="dig">0</span>)
    gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"BOTTOM"</span>,Pattern(<img src="editor_btn_PREVIEW.png" />).similar(<span class="dig">0.81</span>),<span class="dig">70</span>) <span class="cmt"># editor_btn_PREVIEW.png    </span>

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> evalstory_30sec(REGION,moments_png=None, beats_png=None):

    gda_utils.CLICK(REGION,Pattern(<img src="create_img_music-duration-60s.png" />).exact().targetOffset(<span class="dig">80</span>,<span class="dig">4</span>)) <span class="cmt">#create_img_music-duration-60s</span>

    gda_utils.CLICK(REGION,Pattern(<img src="create_btn_music-15-30-60-select.png" />).exact()) <span class="cmt"># create_btn_music-15-30-60-select</span>

    gda_utils.WAIT(REGION,Pattern(<img src="create_img_music-duration-30s.png" />).exact().targetOffset(<span class="dig">87</span>,<span class="dig">3</span>),<span class="dig">10</span>) <span class="cmt"># create_img_music-duration-30s</span>

    gda_utils.CLICK(REGION,Pattern(<img src="editor_btn_PREVIEW.png" />).similar(<span class="dig">0.98</span>)) <span class="cmt"># editor_btn_PREVIEW.png</span>
    <span class="skw">wait</span>(<span class="dig">30</span>)
    gda_utils.WAIT(REGION,Pattern(<img src="editor_btn_PREVIEW.png" />).similar(<span class="dig">0.98</span>),<span class="dig">70</span>) <span class="cmt"># editor_btn_PREVIEW.png    </span>
    <span class="kw">if</span> <span class="kw">not</span> moments_png:
        gda_utils.FIND(REGION,Pattern(<img src="create_img_storyhilites-riseup-30s.png" />).similar(<span class="dig">0.98</span>)) <span class="cmt"># create_img_storyhilites-riseup-30s</span>
    <span class="kw">if</span> <span class="kw">not</span> beats_png:
        gda_utils.FIND(REGION,Pattern(<img src="create_img_musicbeats-riseup-30s.png" />).exact()) <span class="cmt">#create_img_musicbeats-riseup-30s</span>

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> evalstory_15sec(REGION,moments_png=None, beats_png=None):
    gda_utils.CLICK(REGION,Pattern(<img src="create_img_music-duration-30s.png" />).exact().targetOffset(<span class="dig">86</span>,<span class="dig">2</span>)) <span class="cmt"># create_img_music-duration-30s</span>

    gda_utils.CLICK(REGION,Pattern(<img src="create_btn_music-15-30-60-select.png" />).exact().targetOffset(-<span class="dig">1</span>,-<span class="dig">25</span>)) <span class="cmt"># create_btn_music-15-30-60-select</span>

    gda_utils.WAIT(REGION,Pattern(<img src="create_img_music-duration-15s.png" />).exact().targetOffset(<span class="dig">82</span>,<span class="dig">3</span>),<span class="dig">10</span>) <span class="cmt"># create_img_music-duration-15s</span>

    gda_utils.CLICK(REGION,Pattern(<img src="editor_btn_PREVIEW.png" />).similar(<span class="dig">0.98</span>)) <span class="cmt"># editor_btn_PREVIEW.png</span>
    <span class="skw">wait</span>(<span class="dig">15</span>)
    gda_utils.WAIT(REGION,Pattern(<img src="editor_btn_PREVIEW.png" />).similar(<span class="dig">0.98</span>),<span class="dig">70</span>) <span class="cmt"># editor_btn_PREVIEW.png    </span>
    <span class="kw">if</span> <span class="kw">not</span> moments_png:
        gda_utils.FIND(REGION,Pattern(<img src="create_img_storyhilites-riseup-15s.png" />).exact()) <span class="cmt"># create_img_storyhilites-riseup-15s</span>
    <span class="kw">if</span> <span class="kw">not</span> beats_png:
        gda_utils.FIND(REGION,Pattern(<img src="story_img_musicbeats-riseup-15s.png" />).exact()) <span class="cmt">#story_img_musicbeats-riseup-15s</span>

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> select_moment_to_music(REGION):
    <span class="kw">if</span> <span class="kw">not</span> gda_utils.WAIT(REGION,Pattern(<img src="create_txt_media.png" />).similar(<span class="dig">0.81</span>),<span class="dig">5</span>,<span class="dig">70</span>): <span class="cmt"># create_txt_media.png</span>
        <span class="kw">return</span>
    clearstory(REGION)
    gda_utils.CLICK(REGION,Pattern(<img src="editor_img_1-4.png" />).exact().targetOffset(-<span class="dig">136</span>,<span class="dig">0</span>),<span class="dig">2</span>) <span class="cmt"># editor_img_1-4.png</span>
    gda_utils.CLICK(REGION,Pattern(<img src="create_img_music-duration-30s.png" />).similar(<span class="dig">0.96</span>).targetOffset(-<span class="dig">84</span>,<span class="dig">2</span>))

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> record_moments_beat(REGION,duration,max_moments,png):
    <span class="kw">global</span> momentstestcounter

    selectmusicduration(REGION,duration)
    <span class="kw">if</span> selectmoments(REGION,max_moments,duration):
        recordmomentsandbeats(REGION,png,duration)
        gda_utils.CLICK(REGION,Pattern(<img src="create_img_music-duration-30s.png" />).similar(<span class="dig">0.96</span>).targetOffset(-<span class="dig">84</span>,<span class="dig">2</span>))
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"FAILED in selectmoments"</span>
    clearstory(REGION)
    momentstestcounter += <span class="dig">1</span>

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################    </span>
<span class="kw">def</span> setmusic(REGION,png):
    rc=False
    selectmusic(REGION) <span class="cmt"># select goto music screen</span>
    <span class="cmt">#p=gda_utils.PATTERN(png,0.59)</span>
    <span class="cmt">#gda_music_tests.findsongregion(p)</span>
    <span class="kw">if</span> gda_music_tests.selectsong_addtovideo(REGION,png,<span class="dig">0</span>,<span class="dig">60</span>):
        <span class="kw">if</span> gda_utils.WAIT(REGION,Pattern(<img src="create_txt_media.png" />).similar(<span class="dig">0.71</span>),<span class="dig">10</span>):
            <span class="kw">return</span> True
    <span class="cmt">#gda_music_tests.addtovideo(REGION)</span>
    <span class="kw">return</span> rc

<span class="cmt">######################################</span>
<span class="cmt"># Assumes automation window size Mac{x35,y35,w1280, h836}</span>
<span class="cmt"># for windows using Autoit we need to identify the inner region w,h relative to mac and set the win size accordingly</span>
<span class="cmt"># Win,Mac window container border widths are different</span>
<span class="cmt"># this is global region list for more accurate image query</span>
<span class="cmt">######################################</span>
<span class="kw">def</span> set_CREATE_SCREEN_regions(REGION):
    <span class="kw">print</span> <span class="str">"==============================="</span>
    <span class="kw">print</span> <span class="str">"IMAGE PATHS"</span>
    imgPath = getImagePath() <span class="cmt"># get the list</span>
    <span class="cmt"># to loop through</span>
    <span class="kw">for</span> p <span class="kw">in</span> imgPath:
        <span class="kw">print</span> p
    <span class="kw">print</span> <span class="str">"==============================="</span>
    <span class="kw">if</span> gda_utils.d_gda_settings[<span class="str">"isWindows"</span>]==<span class="str">"True"</span>:
        set_Win_CREATE_SCREEN_regions(REGION)
        <span class="kw">return</span> True
    <span class="kw">elif</span> gda_utils.d_gda_settings[<span class="str">"isMac"</span>]==<span class="str">"True"</span>:
        set_Mac_CREATE_SCREEN_regions(REGION)
        <span class="kw">return</span> True
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"ERROR: Invalid platform not Mac or Win"</span>
    <span class="kw">return</span> False

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################  </span>
<span class="kw">def</span> set_Win_CREATE_SCREEN_regions(REGION):
    <span class="cmt">#SetAppWindow.au3  sets the window size &amp; position</span>
    <span class="cmt">#$w=1280,$h=920,$x=@DesktopWidth-($w+10),$y=10; move top right corner,WinMove($hWnd,"",$x,$y,$w,$h)</span>
    <span class="cmt">#main win{X=850,Y=39,Width=1288,Height=855}</span>
    <span class="cmt">#container {X=854,Y=87,Width=1280,Height=803}</span>
    <span class="cmt">#dif width=8 left/right edge</span>
    <span class="cmt">#diff height=52 (the bottom edge and upper menubar</span>
    <span class="cmt">#;mac=set size of window 1 to {1280, 836}</span>
    <span class="cmt">#WinMove($hWnd,"GoPro",600,50,1200,875,1)</span>
    BORDER=<span class="dig">12</span>
    screenregion=<span class="str">"CREATE"</span>
    subregion=<span class="str">"4VIDEOS"</span>
    <span class="kw">print</span> subregion
    rx=REGION.getX()+ BORDER
    ry=REGION.getY()+<span class="dig">160</span>
    rw=<span class="dig">590</span>
    rh=<span class="dig">370</span>
    r=Region(rx,ry,rw,rh)
    <span class="cmt">#r.highlight(10)</span>
    gda_utils.add_region(screenregion,subregion,r)
    <span class="cmt">#return</span>
    r2=r.above(<span class="dig">30</span>)
    subregion=<span class="str">"TITLE"</span>
    <span class="kw">print</span> subregion
    rx=REGION.getX()+ BORDER
    ry=REGION.getY()+<span class="dig">175</span>
    rw=<span class="dig">590</span>
    rh=<span class="dig">50</span>
    r=Region(rx,ry,rw,rh)
    r=r2.grow(<span class="dig">5</span>)
    <span class="cmt">#r.highlight(10)</span>
    gda_utils.add_region(screenregion,subregion,r)
    <span class="cmt">#return</span>

    subregion=<span class="str">"BOTTOM"</span>
    <span class="kw">print</span> subregion
    rx=REGION.getX()+BORDER
    ry=REGION.getY()+REGION.getH()-<span class="dig">70</span>-BORDER
    rw=REGION.getW()-(BORDER*<span class="dig">2</span>)
    rh=<span class="dig">70</span>
    r=Region(rx,ry,rw,rh)
    <span class="cmt">#r.highlight(10)</span>
    gda_utils.add_region(screenregion,subregion,r)
    <span class="cmt">#return</span>

    subregion=<span class="str">"WINDOW"</span>
    <span class="kw">print</span> subregion
    rx=REGION.getX()
    ry=REGION.getY()
    rw=REGION.getW()
    rh=<span class="dig">30</span>
    r=Region(rx,ry,rw,rh)
    <span class="cmt">#r.highlight(10)</span>
    gda_utils.add_region(screenregion,subregion,r)
    <span class="cmt">#return</span>

    subregion=<span class="str">"MENU"</span>
    <span class="kw">print</span> subregion
    rx=REGION.getX()+ BORDER
    ry=REGION.getY()+<span class="dig">32</span><span class="cmt">#+REGION.getH()-80</span>
    rw=REGION.getW()-(BORDER*<span class="dig">2</span>)
    rh=<span class="dig">20</span>
    r=Region(rx,ry,rw,rh)
    <span class="cmt">#r.highlight(10)</span>
    gda_utils.add_region(screenregion,subregion,r)
    <span class="cmt">#return</span>

    subregion=<span class="str">"TOP"</span>
    <span class="kw">print</span> subregion
    rx=REGION.getX()+ BORDER
    ry=REGION.getY()+<span class="dig">55</span><span class="cmt">#+REGION.getH()-80</span>
    rw=REGION.getW()-(BORDER*<span class="dig">2</span>)
    rh=<span class="dig">60</span>
    r=Region(rx,ry,rw,rh)
    <span class="cmt">#r.highlight(10)</span>
    gda_utils.add_region(screenregion,subregion,r)
    <span class="cmt">#return</span>

    subregion=<span class="str">"BEATS"</span>
    r=getbeatswinregion(REGION)
    <span class="cmt">#r.highlight(10)</span>
    gda_utils.add_region(screenregion,subregion,r)

    subregion=<span class="str">"MOMENTS"</span>
    <span class="kw">print</span> subregion
    r=getmomentsregion(r)<span class="cmt">#relative to the beats region win/mac are same</span>
    <span class="cmt">#r.highlight(10)</span>
    gda_utils.add_region(screenregion,subregion,r)
    <span class="cmt">#return</span>

    r1=gda_utils.getregion(<span class="str">"CREATE"</span>,<span class="str">"4VIDEOS"</span>)
    r2=gda_utils.getregion(<span class="str">"CREATE"</span>,<span class="str">"MOMENTS"</span>)
    r3=gda_utils.getregion(<span class="str">"CREATE"</span>,<span class="str">"TOP"</span>)

    subregion=<span class="str">"PLAYER"</span>
    <span class="kw">print</span> subregion
    rx=REGION.getX()+r1.getW()
    ry=REGION.getY()+<span class="dig">120</span>
    rw=REGION.getW()-r1.getW()-BORDER
    rh=(r2.getY()-REGION.getY()-<span class="dig">120</span>)
    <span class="cmt">#print rh</span>
    r=Region(rx,ry,rw,rh)
    <span class="cmt">#r.highlight(10)</span>
    gda_utils.add_region(screenregion,subregion,r)

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################  </span>
<span class="kw">def</span> set_Mac_CREATE_SCREEN_regions(REGION):
    <span class="cmt">#MENUBAR x:0 y:0 w:1280 h: 22  #close win,min win, max/norm win</span>
    <span class="cmt">#TOP x:0 y:22 w:1280 h:56   #view/create button, alerts,settings, user, account/logout</span>
    <span class="cmt">#TITLE x:0 y:78 w:590 h:55</span>
    <span class="cmt">#PLAYER x:602 y:78 w:650 h:420   #play/pause/stop</span>
    <span class="cmt">#4VIDEOS x:0 y:132 w:590 h:380   #video moments selections</span>
    <span class="cmt">#EDITCTRL x:0 y:512 w:1280 h:40   #music title, edit length, clip count, clear editor thumbs and moments selection</span>
    <span class="cmt">#MOMENTS: x:0 y:552 w:1280 h:107  #moments thumb clips</span>
    <span class="cmt">#BEATS:  x:0 y:659 w:1280 h:95  #music beats wave graph</span>
    <span class="cmt">#BOTTOM:   x:0 y:754 w:1280 h:80 #music, outro, start over back to media, save export to mp4</span>
    h1=<span class="dig">1</span>
    screenregion=<span class="str">"CREATE"</span>
    <span class="cmt">#--------------------------------------------</span>
    subregion=<span class="str">"MENUBAR"</span>
    rx=REGION.getX()
    ry=REGION.getY() <span class="cmt">#relative from top</span>
    rw=<span class="dig">1280</span>
    rh=<span class="dig">22</span>
    r=Region(rx,ry,rw,rh)
    r.highlight(h1)
    gda_utils.add_region(screenregion,subregion,r)

    <span class="cmt">#--------------------------------------------</span>
    subregion=<span class="str">"TOP"</span>
    rx=REGION.getX()
    ry=REGION.getY()+<span class="dig">22</span> <span class="cmt">#relative from top</span>
    rw=<span class="dig">1280</span>
    rh=<span class="dig">56</span>
    r=Region(rx,ry,rw,rh)
    r.highlight(h1)
    gda_utils.add_region(screenregion,subregion,r)

    <span class="cmt">#--------------------------------------------</span>
    subregion=<span class="str">"TITLE"</span>
    rx=REGION.getX()
    ry=REGION.getY()+<span class="dig">78</span> <span class="cmt">#relative from top</span>
    rw=<span class="dig">590</span>
    rh=<span class="dig">55</span>
    r=Region(rx,ry,rw,rh)
    r.highlight(h1)
    gda_utils.add_region(screenregion,subregion,r)

    <span class="cmt">#--------------------------------------------</span>
    subregion=<span class="str">"PLAYER"</span>
    rx=REGION.getX()+<span class="dig">602</span>
    ry=REGION.getY()+<span class="dig">78</span> <span class="cmt">#relative from top</span>
    rw=<span class="dig">650</span>
    rh=<span class="dig">420</span>
    r=Region(rx,ry,rw,rh)
    r.highlight(h1)
    gda_utils.add_region(screenregion,subregion,r)


    <span class="cmt">#--------------------------------------------</span>
    subregion=<span class="str">"4VIDEOS"</span>
    rx=REGION.getX()
    ry=REGION.getY()+<span class="dig">132</span> <span class="cmt">#relative from top</span>
    rw=<span class="dig">590</span>
    rh=<span class="dig">380</span>
    r=Region(rx,ry,rw,rh)
    r.highlight(h1)
    gda_utils.add_region(screenregion,subregion,r)

    <span class="cmt">#--------------------------------------------</span>
    subregion=<span class="str">"EDITCTRL"</span>
    rx=REGION.getX()
    ry=REGION.getY()+REGION.getH()-<span class="dig">326</span> <span class="cmt">#relative from bottom</span>
    rw=<span class="dig">1280</span>
    rh=<span class="dig">40</span>
    r=Region(rx,ry,rw,rh)
    r.highlight(h1)
    gda_utils.add_region(screenregion,subregion,r)

    <span class="cmt">#--------------------------------------------</span>
    subregion=<span class="str">"MOMENTS"</span>
    rx=REGION.getX()
    ry=REGION.getY()+REGION.getH()-<span class="dig">280</span> <span class="cmt">#relative from bottom</span>
    rw=<span class="dig">1280</span>
    rh=<span class="dig">107</span>
    r=Region(rx,ry,rw,rh)
    r.highlight(h1)
    gda_utils.add_region(screenregion,subregion,r)

    <span class="cmt">#--------------------------------------------</span>
    subregion=<span class="str">"BEATS"</span>
    rx=REGION.getX()
    ry=REGION.getY()+REGION.getH()-<span class="dig">177</span> <span class="cmt">#relative from bottom</span>
    rw=<span class="dig">1280</span>
    rh=<span class="dig">96</span>
    r=Region(rx,ry,rw,rh)
    r.highlight(h1)
    gda_utils.add_region(screenregion,subregion,r)

    <span class="cmt">#--------------------------------------------    </span>
    subregion=<span class="str">"BOTTOM"</span>
    rx=REGION.getX()
    ry=REGION.getY()+REGION.getH()-<span class="dig">80</span> <span class="cmt">#relative from bottom</span>
    rw=<span class="dig">1280</span>
    rh=<span class="dig">80</span>
    r=Region(rx,ry,rw,rh)
    r.highlight(h1)
    gda_utils.add_region(screenregion,subregion,r)



<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> reset(REGION):
    <span class="kw">if</span> gda_music_tests.back(REGION):
        <span class="kw">return</span> True
    <span class="kw">return</span> False
<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># this is obsolete</span>
<span class="cmt">######################################</span>
<span class="kw">def</span> regression_moments_beats(GPA,REGION):
    <span class="kw">global</span> momentstestcounter
    failcount=<span class="dig">0</span>
    gda_utils.WAIT(REGION,Pattern(<img src="create_txt_media.png" />).similar(<span class="dig">0.81</span>),<span class="dig">5</span>) <span class="cmt"># create_txt_media.png</span>
    msongs=gda_music_tests.GDA_music()
    <span class="kw">if</span> <span class="kw">not</span> msongs:
        <span class="kw">print</span> <span class="str">"FAILED to init music song list gda_music_tests.GDA_music"</span>
        <span class="kw">return</span> False
    msongs.songreport()
    gda_music_tests.testmusic_init(msongs)
<span class="cmt">#    clearstory(REGION)</span>
    <span class="kw">if</span> <span class="kw">not</span> init_music(REGION,msongs):
        <span class="kw">print</span> <span class="str">"FAILED to init music screen song list"</span>
        <span class="kw">return</span> False


    <span class="kw">for</span> i <span class="kw">in</span> range(<span class="dig">0</span>,msongs.getGDAsongcount()):
        <span class="kw">try</span>:
            title, png, t15, t30, t60 = msongs.getsortednextsong()
            clearstory(REGION)
            setmusic(REGION,png)
            clearstory(REGION)
            selectmusicduration(REGION,<span class="dig">60</span>)
            selectmoments(REGION,t60,<span class="dig">60</span>)
            verifymomentsandbeats(REGION,png,<span class="dig">60</span>)
            selectmusicduration(REGION,<span class="dig">30</span>)
            verifymomentsandbeats(REGION,png,<span class="dig">30</span>)
            selectmusicduration(REGION,<span class="dig">15</span>)
            verifymomentsandbeats(REGION,png,<span class="dig">15</span>)
            gda_utils.putDictToFile(gda_utils.d_similarity)
            momentstestcounter += <span class="dig">1</span>
        <span class="kw">except</span> Exception <span class="kw">as</span> e:
            <span class="kw">print</span> <span class="str">"Error: %s"</span> % str(e)
            failcount += <span class="dig">1</span>

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################       </span>
<span class="kw">def</span> doesrecordfilesexists(png,gda_music_images):
    rc=False
    durations = [<span class="dig">60</span>,<span class="dig">30</span>,<span class="dig">15</span>]
    count=<span class="dig">0</span>
    path1=None
    path2=None
    <span class="kw">for</span> dur <span class="kw">in</span> durations:
        rc1,imgpath1 = getbeatsfilename(png,dur,gda_music_images)
        rc2,imgpath2 = getmomentsfilename(png,dur,gda_music_images)
        <span class="kw">if</span> <span class="kw">not</span> rc1 <span class="kw">or</span> <span class="kw">not</span> rc2:
            count+=<span class="dig">1</span>
            path1=imgpath1
            path2=imgpath2
    <span class="kw">if</span> count==<span class="dig">0</span>:
        rc=True

    <span class="kw">return</span> rc, path1,path2

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> createmoment():
    <span class="kw">print</span> <span class="str">"createmoment &gt;&gt;&gt;&gt;&gt;"</span>
    p=Pattern(<img src="editor_img_1-4.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">242</span>,<span class="dig">0</span>)

    bslow=True
    rc= gda_utils.CLICK3(<span class="str">"CREATE"</span>,<span class="str">"4VIDEOS"</span>,p,<span class="dig">5</span>,bslow)
    <span class="kw">if</span> rc:
        <span class="kw">print</span> <span class="str">"createmoment: OK"</span>
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"createmonent: FAILED, not clicked"</span>
    <span class="kw">print</span> <span class="str">"createmoment &lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> rc

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> previewplay(duration):
    rc = False
    gda_utils.CLICK3(<span class="str">"CREATE"</span>,<span class="str">"BOTTOM"</span>,Pattern(<img src="create_btn_preview.png" />).similar(<span class="dig">0.69</span>))
    <span class="skw">wait</span>(duration+<span class="dig">10</span>)
    mouseMove(Location(<span class="dig">0</span>,<span class="dig">0</span>))
    <span class="skw">wait</span>(<span class="dig">1</span>)
    mprev=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"BOTTOM"</span>,Pattern(<img src="create_btn_preview.png" />).similar(<span class="dig">0.69</span>),<span class="dig">10</span>)
    <span class="kw">if</span> mprev:
        rc = True  <span class="cmt"># preview ends and returns to create screen view</span>
    <span class="kw">else</span>: <span class="cmt"># stuck in preview is a fail try to get out of preview</span>
        <span class="kw">print</span> <span class="str">"FAILED song &amp; video preview: Stuck and did not return to create screen."</span>
        mstop=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"BOTTOM"</span>, Pattern(<img src="create_btn_stop-nohighlight.png" />).similar(<span class="dig">0.69</span>),<span class="dig">5</span>)
        <span class="kw">if</span> mstop:
            mstop.<span class="skw">click</span>()
            <span class="skw">wait</span>(<span class="dig">1</span>)
            <span class="cmt">#rbottom=gda_utils.getregion("CREATE","BOTTOM")</span>
            mouseMove(Location(<span class="dig">0</span>,<span class="dig">0</span>))
            mprev=gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"BOTTOM"</span>,Pattern(<img src="create_btn_preview.png" />).similar(<span class="dig">0.69</span>),<span class="dig">10</span>)
            <span class="kw">if</span> <span class="kw">not</span> mprev:
                <span class="kw">print</span> <span class="str">"FAILED to exit out of preview"</span>
    <span class="kw">return</span> rc

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> putsongitem(songitem,index=-<span class="dig">1</span>):
    <span class="kw">global</span> d_report
    <span class="kw">if</span> index&gt;=<span class="dig">0</span>: <span class="cmt">#valid index</span>
        <span class="kw">if</span> index&lt;len(d_report[<span class="str">"songs"</span>]):
            d_report[<span class="str">"songs"</span>][index]=songitem
            <span class="kw">return</span> True
    <span class="kw">else</span>: <span class="cmt">#search for expected song </span>
        <span class="kw">for</span> i <span class="kw">in</span> range(<span class="dig">0</span>,len(d_report[<span class="str">"songs"</span>])):
            <span class="kw">if</span> d_report[<span class="str">"songs"</span>][i][<span class="str">"png"</span>]==songitem[<span class="str">"png"</span>]:
                d_report[<span class="str">"songs"</span>][i]=songitem
                <span class="kw">return</span> True
    <span class="kw">return</span> False

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># return dict song item and array index</span>
<span class="cmt">######################################</span>
<span class="kw">def</span> getsongitem(png):
    <span class="kw">global</span> d_report
    <span class="kw">if</span> <span class="str">"songs"</span> <span class="kw">in</span> d_report:

        <span class="kw">for</span> i <span class="kw">in</span> range(<span class="dig">0</span>,len(d_report[<span class="str">"songs"</span>])):
            songitem=d_report[<span class="str">"songs"</span>][i]
            <span class="kw">if</span> <span class="str">"png"</span> <span class="kw">in</span> songitem:
                <span class="kw">if</span> songitem[<span class="str">"png"</span>]==png:
                    <span class="kw">return</span> songitem,i
    <span class="kw">else</span>:
        <span class="kw">print</span> str(d_report)
        exit(-<span class="dig">1</span>)
    <span class="kw">return</span> None,-<span class="dig">1</span>

<span class="kw">def</span> update_regression_report_summary():
    <span class="kw">global</span> d_report
    faillist=[]
    errorlist=[]
    passcount=<span class="dig">0</span>
    failcount=<span class="dig">0</span>
    songcount=len(d_report[<span class="str">"songs"</span>])
    errors=<span class="dig">0</span>
    report={}
    sfail=<span class="str">""</span>
    serror=<span class="str">""</span>
    version=<span class="str">""</span>

    <span class="kw">if</span> <span class="str">"version"</span> <span class="kw">in</span> d_report:
        version=d_report[<span class="str">"version"</span>] <span class="cmt">#Mac 2.0.0.4334</span>
    <span class="kw">for</span> songitem <span class="kw">in</span> d_report[<span class="str">"songs"</span>]:
        sitem=<span class="str">""</span>
        <span class="kw">if</span> <span class="str">"png"</span> <span class="kw">not</span> <span class="kw">in</span> songitem:
            <span class="kw">continue</span> <span class="cmt"># must have song ref</span>
        <span class="kw">if</span> <span class="str">"PASSED"</span> <span class="kw">in</span> songitem:
            <span class="kw">if</span> songitem[<span class="str">"PASSED"</span>]==<span class="str">"Song Regression Tests"</span>:
                passcount += <span class="dig">1</span>
        <span class="kw">elif</span> <span class="str">"FAILED"</span> <span class="kw">in</span> songitem:
            failcount += <span class="dig">1</span>
            faillist.append(songitem)
            <span class="kw">if</span> songitem[<span class="str">"FAILED"</span>] <span class="kw">in</span> songitem:
                err=songitem[songitem[<span class="str">"FAILED"</span>]]
                <span class="kw">if</span> err:
                    <span class="kw">if</span> isinstance(err,list):
                        sitem+=str(err)
<span class="cmt">#                        if len(err)&gt;0:</span>
 <span class="cmt">#                           for item in err:</span>
  <span class="cmt">#                              sitem += item+"\n"</span>
                    <span class="kw">else</span>:
                        sitem = str(err)+<span class="str">"\n"</span>

                sfail += <span class="str">"\nFAILED: %s ---------\n%s"</span> % (songitem[<span class="str">"title"</span>],sitem)
        <span class="kw">elif</span> <span class="str">"Script ERROR"</span> <span class="kw">in</span> songitem:
            errors += <span class="dig">1</span>
            errorlist.append(songitem)
            <span class="kw">if</span> <span class="str">"Script ERROR"</span> <span class="kw">in</span> songitem:
                err=songitem[<span class="str">"Script ERROR"</span>]
                <span class="kw">if</span> err:
                    <span class="kw">if</span> isinstance(err,list):
                        sitem+=str(err)
<span class="cmt">#                        for item in err:</span>
 <span class="cmt">#                           sitem += item+"\n"</span>
                    <span class="kw">else</span>:
                        sitem = str(err)+<span class="str">"\n"</span>

                serror += <span class="str">"\nERRORS: %s ---------\n%s"</span> % (songitem[<span class="str">"title"</span>],sitem)

    totaltest=passcount+failcount+errors
    report[<span class="str">"title"</span>]=<span class="str">"QUIK Song Regression Test %i of %i songs processed %s"</span> % (totaltest,songcount,version)
    report[<span class="str">"passfail"</span>]=<span class="str">"RUN STATUS: PASSED=%i, FAILED=%i, ERRORS=%i"</span> % (passcount,failcount,errors)
    report[<span class="str">"passed"</span>]=passcount
    report[<span class="str">"failed"</span>]=failcount
    report[<span class="str">"errors"</span>]=errors
    report[<span class="str">"songcount"</span>]=songcount
    report[<span class="str">"failedinfo"</span>]=faillist
    report[<span class="str">"errorlist"</span>]=errorlist
    report[<span class="str">"failinfo"</span>]=sfail
    report[<span class="str">"errorinfo"</span>]=serror
    d_report[<span class="str">"summaryreport"</span>]=report
    <span class="kw">print</span> <span class="str">"==================================================="</span>
    <span class="kw">print</span> <span class="str">" S U M M A R Y - R E P O R T"</span>
    <span class="kw">print</span> <span class="str">"==================================================="</span>
    <span class="kw">print</span> report[<span class="str">"title"</span>]
    <span class="kw">print</span> report[<span class="str">"passfail"</span>]
    <span class="kw">print</span> report[<span class="str">"failinfo"</span>]
    <span class="kw">print</span> report[<span class="str">"errorinfo"</span>]
    <span class="kw">print</span> <span class="str">"==================================================="</span>
    <span class="kw">print</span> <span class="str">"==================================================="</span>

<span class="cmt">######################################</span>
<span class="cmt"># write the test result to JSON format </span>
<span class="cmt"># d_song,id required for reporting</span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> update_report(passfail,test,msg,title,d_song,id,testmode=<span class="str">"gda_create_tests_regression_reportpath"</span>): <span class="cmt">#gda_create_tests_record_reportpath</span>
    <span class="kw">global</span> d_report
    <span class="kw">print</span> <span class="str">"REPORT ITEM ========================"</span>
    <span class="kw">print</span> <span class="str">"%s-%s - %s"</span> % (str(passfail),title,msg)
    rc=False
    <span class="kw">if</span> d_song <span class="kw">and</span> id&gt;=<span class="dig">0</span>:
        prevdate=gda_utils.getdate()
        <span class="kw">if</span> <span class="str">"lastdate"</span> <span class="kw">in</span> d_song:
            prevdate=d_song[<span class="str">"lastdate"</span>]
        <span class="kw">else</span>:
            prevtime=gda_utils.gettime()
        <span class="kw">if</span> <span class="str">"lasttime"</span> <span class="kw">in</span> d_song:
            prevtime=d_song[<span class="str">"lasttime"</span>]

        d_song[<span class="str">"lastdate"</span>] = gda_utils.getdate()
        d_song[<span class="str">"lasttime"</span>] = gda_utils.gettime()
        d_song[test] = msg
        <span class="kw">if</span> passfail:
            d_song[<span class="str">"PASSED"</span>]=test
            <span class="kw">if</span> <span class="str">"FAILED"</span> <span class="kw">in</span> d_song:
                smsg=<span class="str">"FAILED %s-%s: %s\n"</span> % (prevdate,prevtime,str(d_song[<span class="str">"FAILED"</span>]))
                <span class="cmt">#show history from failed to passed state</span>
                <span class="kw">if</span> <span class="str">"summaryreport"</span> <span class="kw">not</span> <span class="kw">in</span> d_report:
                    d_report[<span class="str">"summaryreport"</span>]={}
                <span class="kw">if</span> <span class="str">"failinfo"</span> <span class="kw">in</span> d_report[<span class="str">"summaryreport"</span>]:
                    smsg=<span class="str">"FAILED %s-%s: %s\n"</span> % (prevdate,prevtime,str(d_song[<span class="str">"FAILED"</span>]))
                    d_report[<span class="str">"summaryreport"</span>][<span class="str">"failinfo"</span>] += smsg
                <span class="kw">else</span>:
                    d_report[<span class="str">"summaryreport"</span>][<span class="str">"failinfo"</span>] = smsg
                <span class="kw">del</span> d_song[<span class="str">"FAILED"</span>]
            gda_utils.passtotal += <span class="dig">1</span>
        <span class="kw">else</span>:
            <span class="kw">if</span> <span class="str">"PASSED"</span> <span class="kw">in</span> d_song: <span class="kw">del</span> d_song[<span class="str">"PASSED"</span>]
            d_song[<span class="str">"FAILED"</span>]=test
            gda_utils.failtotal += <span class="dig">1</span>
        rc=putsongitem(d_song,id) <span class="cmt"># update d_report of the song results</span>
        update_regression_report_summary() <span class="cmt">#refresh run summary</span>
        <span class="kw">if</span> testmode <span class="kw">in</span> gda_utils.d_gda_settings:
            gda_utils.putDictToFile(d_report,gda_utils.d_gda_settings[testmode])
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"================================="</span>
            <span class="kw">print</span> <span class="str">"FAILED to save report JSON"</span>
            <span class="kw">print</span> <span class="str">"gda_utils.d_gda_settings key error: testmode=%s"</span> % testmode
            <span class="kw">print</span> <span class="str">"================================="</span>
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"================================="</span>
        <span class="kw">print</span> <span class="str">"FAILED to save report JSON"</span>
        <span class="kw">print</span> <span class="str">"d_song=%s %s"</span> % (title,testmode)
        <span class="kw">print</span> <span class="str">"================================="</span>
    <span class="kw">return</span> rc

<span class="cmt">######################################</span>
<span class="cmt">#</span>
<span class="cmt"># </span>
<span class="kw">def</span> nav_to_create_screen():
    <span class="kw">if</span> gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"TOP"</span>,Pattern(<img src="media_btn_add-media.png" />).similar(<span class="dig">0.69</span>).targetOffset(-<span class="dig">47</span>,<span class="dig">1</span>),<span class="dig">5</span>):
        gda_utils.CLICK3(<span class="str">"CREATE"</span>,<span class="str">"TOP"</span>,Pattern(<img src="media_btn_create.png" />).similar(<span class="dig">0.69</span>))
    <span class="kw">if</span> <span class="kw">not</span> gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"TITLE"</span>,Pattern(<img src="create_txt_media.png" />).similar(<span class="dig">0.69</span>),<span class="dig">5</span>): <span class="cmt"># create_txt_media.png</span>
<span class="cmt">#        gda_music_tests.back(REGION) #check if gda stuck in music screen, go back</span>
<span class="cmt">#        if not gda_utils.EXISTS3("CREATE","TITLE",Pattern("create_txt_media.png").similar(0.69),5): # create_txt_media.png</span>
        <span class="kw">print</span> <span class="str">"FAILED to find CREATE screen. Testrun will exit"</span>
        <span class="kw">return</span> exit(-<span class="dig">1</span>)


<span class="cmt">######################################</span>
<span class="cmt"># iterates the music list and verifies screenshots of </span>
<span class="cmt"># the music beats graph and moments graph</span>
<span class="cmt"># checks regression json and skips songs with test data</span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> regression_momentsbeats(REGION):
    <span class="kw">global</span> momentstestcounter
    <span class="kw">global</span> d_report
    exceptionlist=<span class="str">""</span>
    failmsglist=<span class="str">""</span>
    failcount=<span class="dig">0</span>
    errorcount=<span class="dig">0</span>
    skippcount=<span class="dig">0</span>
    gda_utils.failexit=<span class="dig">99</span>
    set_CREATE_SCREEN_regions(REGION)
    gda_music_tests.set_MUSIC_SCREEN_regions(REGION)

    <span class="kw">if</span> <span class="kw">not</span> gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"TITLE"</span>,Pattern(<img src="create_txt_media.png" />).similar(<span class="dig">0.69</span>),<span class="dig">10</span>): <span class="cmt"># create_txt_media.png</span>
        <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
        <span class="kw">print</span> <span class="str">"FAILED to find CREATE STORY SCREEN"</span>
        gda_music_tests.back(REGION) <span class="cmt">#check if gda stuck in music screen, go back</span>
        <span class="kw">if</span> <span class="kw">not</span> gda_utils.EXISTS3(<span class="str">"CREATE"</span>,<span class="str">"TITLE"</span>,Pattern(<img src="create_txt_media.png" />).similar(<span class="dig">0.69</span>),<span class="dig">5</span>): <span class="cmt"># create_txt_media.png</span>
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
            <span class="kw">print</span> <span class="str">"FAILED to find CREATE STORY SCREEN"</span>
            <span class="kw">print</span> <span class="str">"Exiting test run"</span>
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
            <span class="kw">return</span> False

    msongs=gda_create_init()
<span class="cmt">#    rc=clearstory(REGION) #clear to reset for moments selection test</span>
<span class="cmt">#    rc=createmoment() #set one moment so song iteration can select the next song</span>

    title=<span class="str">""</span>
    png=<span class="str">""</span>
    t15=<span class="dig">0</span>
    t30=<span class="dig">0</span>
    t60=<span class="dig">0</span>
    durations = [<span class="dig">60</span>,<span class="dig">30</span>,<span class="dig">15</span>]
    e=<span class="str">""</span>
    tempfail=failcount
    temperr=errorcount

    <span class="kw">for</span> i <span class="kw">in</span> range(<span class="dig">0</span>,msongs.getGDAsongcount()):
        <span class="kw">if</span> i&gt;<span class="dig">0</span>:
            <span class="kw">print</span> <span class="str">"DEBUG exit"</span>
            <span class="cmt">#break</span>
        reportname=<span class="str">"Song-%d. regression_momentsbeats - %s"</span> % (momentstestcounter,title)
        gda_utils.printreport(reportname,False)
        gda_utils.failcount+=gda_utils.failtotal
        gda_utils.failtotal=<span class="dig">0</span>
        gda_utils.passcount+=gda_utils.passtotal
        gda_utils.passtotal=<span class="dig">0</span>
        <span class="kw">if</span> errorcount&gt;temperr:
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
            <span class="kw">print</span> <span class="str">"ERROR EXCEPTIONS"</span>
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
            <span class="kw">print</span> exceptionlist
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>

        <span class="kw">if</span> failcount&gt;tempfail:
            <span class="kw">print</span> <span class="str">"::::::::::::::::::::::::::::::::::::::::::::"</span>
            <span class="kw">print</span> <span class="str">"WORKFLOW FAILURES"</span>
            <span class="kw">print</span> failmsglist
            <span class="kw">print</span> <span class="str">"::::::::::::::::::::::::::::::::::::::::::::"</span>
            <span class="cmt">#if failcount==3 or errorcount==3:</span>
            <span class="cmt">#    gda,REGION=refreshscreenregion()</span>
        <span class="kw">if</span> failcount&gt;<span class="dig">10</span> <span class="kw">or</span> errorcount&gt;<span class="dig">10</span>: <span class="cmt">#restart the script if too many workflow errors</span>
            <span class="kw">print</span> <span class="str">"Exiting test run"</span>
            gda_utils.ScreenShot(REGION,<span class="str">""</span>,<span class="str">"FAILURES"</span>)
            exit(-<span class="dig">1</span>) <span class="cmt">#shell should be running in a loop and restart this run</span>
        tempfail=failcount
        temperr=errorcount
        rc=False
        d_song=None <span class="cmt">#the song node item</span>
        test=None <span class="cmt">#child test item of d_song</span>
        id=-<span class="dig">1</span>
        <span class="kw">print</span> <span class="str">"================================================="</span>
        <span class="kw">try</span>:
            title, png, t15, t30, t60 = msongs.getsortednextsong()
            rc,d_pngregressionpaths=getregressionfilelists(png,gda_utils.d_gda_settings[<span class="str">"gda_music_images"</span>])
            <span class="kw">if</span> <span class="kw">not</span> rc:
                <span class="kw">print</span> <span class="str">"SKIPPED: Not all png regression files found OR\n Already processed as PASSED\nSKIPPED:%s"</span> % png
                <span class="kw">continue</span>
            rc = checkexclusivetests(msongs,png)
            <span class="kw">if</span> <span class="kw">not</span> rc:
                <span class="kw">print</span> <span class="str">"SKIPPED: Running in exclusive song mode, SKIPPING:%s"</span> % png
                <span class="kw">continue</span>

            momentstestcounter += <span class="dig">1</span>
            <span class="kw">if</span> rc: <span class="cmt">#start validate the beats &amp; story &amp; moments files for regression  </span>
                d_song,id=getsongitem(png)
                <span class="kw">if</span> <span class="kw">not</span> d_song <span class="kw">or</span> id&lt;<span class="dig">0</span>:
                    e = <span class="str">"ERROR in getsongitem: invalid song obj or id-%s: SKIPPING song %s"</span> % (png,title)
                    update_report(False,<span class="str">"getsongitem"</span>,e,title,None,id)
                    <span class="kw">continue</span>

                rc=selectmusicduration(REGION,<span class="dig">60</span>)
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    e = <span class="str">"ERROR in selectmusicduration-%d: SKIPPING song %s"</span> % (<span class="dig">60</span>,title)
                    update_report(rc,<span class="str">"select music duration-60"</span>,e,title,d_song,id)
                    <span class="kw">continue</span>

                rc=clearstory(REGION) <span class="cmt">#clear to reset for moments selection test</span>
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    e= <span class="str">"ERROR in clearstory: SKIPPING song %s"</span> % title
                    update_report(rc,<span class="str">"clear story"</span>,e,title,d_song,id)
                    <span class="kw">continue</span>

                rc=createmoment() <span class="cmt">#set one moment so song iteration can select the next song</span>
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    e= <span class="str">"ERROR in createmoment: SKIPPING song %s"</span> % title
                    update_report(rc,<span class="str">"create moment"</span>,e,title,d_song,id)
                    <span class="kw">continue</span>

                rc=setmusic(REGION,png) <span class="cmt">#goto music screen and select the song iteration title and return to create screen                </span>
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    e= <span class="str">"ERROR in setmusic: SKIPPING song %s"</span> % title
                    update_report(rc,<span class="str">"setmusic"</span>,e,title,d_song,id)
                    <span class="kw">continue</span>

                rc=clearstory(REGION) <span class="cmt">#clear to reset for moments selection test</span>
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    e= <span class="str">"ERROR in clearstory: SKIPPING song %s"</span> % title
                    update_report(rc,<span class="str">"clear story"</span>,e,title,d_song,id)
                    <span class="kw">continue</span>

                rc,test=selectmoments(REGION,t60,<span class="dig">60</span>,png)
                <span class="kw">if</span> test:
                    d_song[<span class="str">"selectmoments"</span>]=test
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    e= <span class="str">"ERROR in selectmoments: SKIPPING song %s"</span> % title
                    update_report(rc,<span class="str">"select moments-60"</span>,e,title,d_song,id)
                    <span class="kw">continue</span>

                <span class="kw">for</span> dur <span class="kw">in</span> durations:
                    <span class="kw">if</span> <span class="kw">not</span> rc:
                        <span class="kw">break</span> <span class="cmt">#fail song item test on first found fail and continue to next song                    </span>
                    <span class="kw">if</span> dur==<span class="dig">60</span>:
                        <span class="cmt">#verify moments selection</span>
                        <span class="cmt">#play music to end</span>
                        <span class="cmt">#verifymomentandbeats</span>
                        <span class="cmt"># report pass/fail json</span>
                        rc=previewplay(dur)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e = <span class="str">"FAILED: previewplay=%d"</span> % dur
                            update_report(rc,<span class="str">"previewplay-60"</span>,e,title,d_song,id)
                            <span class="kw">break</span>
                        msg=<span class="str">"%s-%d"</span> % (png,dur)
                        gda_utils.ScreenShot(REGION,<span class="str">""</span>,msg)
                        rc,d_song,msg=verifymomentsandbeats(REGION,d_song,d_pngregressionpaths,png,dur,t60)

                        <span class="kw">print</span> str(rc)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e = <span class="str">"FAILED: verifymomentsandbeats(REGION,d_song,d_pngregressionpaths,png,dur,t60)"</span>
                            update_report(rc,msg,e,title,d_song,id)
                            <span class="kw">break</span>

                    <span class="kw">elif</span> dur==<span class="dig">30</span>:
                        rc=selectmusicduration(REGION,dur)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e= <span class="str">"ERROR in selectmusicduration-%d: SKIPPING song %s"</span> % (dur,title)
                            update_report(rc,<span class="str">"select music duration-30"</span>,e,title,d_song,id)
                            <span class="kw">break</span>
                        rc=previewplay(dur)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e = <span class="str">"FAILED: previewplay=%d"</span> % dur
                            update_report(rc,<span class="str">"previewplay-30"</span>,e,title,d_song,id)
                            <span class="kw">break</span>
                        msg=<span class="str">"%s-%d"</span> % (png,dur)
                        gda_utils.ScreenShot(REGION,<span class="str">""</span>,msg)
                        rc,d_song,msg=verifymomentsandbeats(REGION,d_song,d_pngregressionpaths,png,dur,t30)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e = <span class="str">"FAILED: verifymomentsandbeats(REGION,d_song,d_pngregressionpaths,png,dur,t30)"</span>
                            update_report(rc,msg,e,title,d_song,id)
                            <span class="kw">break</span>
                    <span class="kw">elif</span> dur==<span class="dig">15</span>:
                        rc=selectmusicduration(REGION,dur)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e= <span class="str">"ERROR in selectmusicduration-%d: SKIPPING song %s"</span> % (dur,title)
                            update_report(rc,<span class="str">"select music duration-15"</span>,e,title,d_song,id)
                            <span class="kw">break</span>
                        rc=previewplay(dur)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e = <span class="str">"FAILED: previewplay=%d"</span> % dur
                            update_report(rc,<span class="str">"previewplay-15"</span>,e,title,d_song,id)
                            <span class="kw">break</span>
                        msg=<span class="str">"%s-%d"</span> % (png,dur)
                        gda_utils.ScreenShot(REGION,<span class="str">""</span>,msg)
                        rc,d_song,msg=verifymomentsandbeats(REGION,d_song,d_pngregressionpaths,png,dur,t15)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e = <span class="str">"FAILED: verifymomentsandbeats(REGION,d_song,d_pngregressionpaths,png,dur,t15)"</span>
                            update_report(rc,msg,e,title,d_song,id)
                            <span class="kw">break</span>
                    <span class="kw">else</span>:
                        <span class="kw">print</span> <span class="str">"INVALID MOMENTS DURATION !!!!!!!!!!!!!!!"</span>

                <span class="kw">if</span> rc: <span class="cmt">#report passed test</span>
                    update_report(rc,<span class="str">"Song Regression Tests"</span>,<span class="str">"OK"</span>,title,d_song,id)


                    <span class="cmt">#d_song["PASSED"]="True"</span>
                <span class="cmt">#rc=putsongitem(d_song,id) # update d_report of the song results        </span>
                <span class="cmt">#gda_utils.putDictToFile(d_report,gda_utils.d_gda_settings["gda_create_tests_record_reportpath"])</span>
                gda_utils.putDictToFile(gda_utils.d_similarity)

                <span class="kw">print</span> <span class="str">"VERIFIED %d: SONG :\n%s\n%s"</span> % (momentstestcounter,png,title)
            <span class="kw">else</span>:
                <span class="kw">print</span> <span class="str">"SKIPPED %d: SONG :\n%s\n%s"</span> % (momentstestcounter,png,title)
                skippcount+=<span class="dig">1</span>
        <span class="kw">except</span> Exception <span class="kw">as</span> err:
            errorcount += <span class="dig">1</span>
            <span class="cmt"># stackinfo=traceback.format_exc()</span>
            tb = sys.exc_info()[<span class="dig">2</span>]
            tbinfo = <span class="str">""</span>
            tbinfo = traceback.extract_tb(tb)
            update_report(False,<span class="str">"Script ERROR"</span>,tbinfo,str(title),d_song,id)

            <span class="kw">print</span> tbinfo  <span class="cmt"># should print a list with entries like</span>
            exceptionlist += <span class="str">"\n%i-----------------------\n%s\n%s\n"</span> % (errorcount, err, str(tbinfo))
            <span class="kw">print</span> <span class="str">"Error: %s"</span> % str(err)
            <span class="kw">print</span> <span class="str">"ERROR %d: File not saved"</span> % (momentstestcounter)

            <span class="kw">if</span> d_song <span class="kw">and</span> id &gt; -<span class="dig">1</span>:
                rc = putsongitem(d_song, id)
                gda_utils.putDictToFile(d_report, gda_utils.d_gda_settings[<span class="str">"gda_create_tests_record_reportpath"</span>])
                gda_utils.putDictToFile(gda_utils.d_similarity)
            <span class="kw">if</span> len(exceptionlist) &gt; <span class="dig">0</span>:
                <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
                <span class="kw">print</span> <span class="str">"ERROR EXCEPTIONS"</span>
                <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
                <span class="kw">print</span> exceptionlist
                <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
                <span class="kw">print</span> <span class="str">"::::::::::::::::::::::::::::::::::::::::::::"</span>
                <span class="kw">print</span> <span class="str">"WORKFLOW FAILURES"</span>
                <span class="kw">print</span> failmsglist
                <span class="kw">print</span> <span class="str">"::::::::::::::::::::::::::::::::::::::::::::"</span>
                <span class="kw">print</span> <span class="str">"Exiting test run"</span>
                gda_utils.ScreenShot(REGION, <span class="str">""</span>, <span class="str">"ExceptionErrors"</span>)
                <span class="kw">if</span> errorcount &gt; <span class="dig">5</span>:
                    <span class="kw">print</span> <span class="str">"EXCEPTION ERRORS: Too many errors=%i exiting this run"</span> % errorcount
                    exit(-<span class="dig">1</span>)




<span class="cmt">######################################</span>
<span class="cmt"># iterates the music list and grabs screenshots of </span>
<span class="cmt"># the music beats graph and moments graph</span>
<span class="cmt"># doesrecordfilesexists checks for png files and skips</span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> record_momentsbeats(REGION):
    <span class="kw">global</span> momentstestcounter
    <span class="kw">global</span> d_report
    rc=False
    exceptionlist=<span class="str">""</span>
    failmsglist=<span class="str">""</span>
    failcount=<span class="dig">0</span>
    errorcount=<span class="dig">0</span>
    skippcount=<span class="dig">0</span>
    gda_utils.failexit=<span class="dig">99</span>
    set_CREATE_SCREEN_regions(REGION)
    gda_music_tests.set_MUSIC_SCREEN_regions(REGION)
<span class="cmt"># record_momentsbeats</span>
    nav_to_create_screen()

    msongs=gda_create_init(True)
    <span class="kw">if</span> <span class="kw">not</span> msongs:
        <span class="kw">print</span> <span class="str">"Error: msongs=gda_create_init(2.0.0.9999,True)"</span>
        <span class="kw">return</span> False
<span class="cmt">#    rc=clearstory(REGION) #clear to reset for moments selection test</span>
<span class="cmt">#    rc=createmoment() #set one moment so song iteration can select the next song</span>
    tr=None
    <span class="kw">if</span> <span class="str">'testrail'</span> <span class="kw">in</span> gda_utils.d_gda_settings:
        tr=gda_utils.d_gda_settings[<span class="str">'testrail'</span>]
        <span class="kw">if</span> <span class="kw">not</span> tr:
            <span class="kw">print</span> <span class="str">"No Testrail object in settings"</span>
            exit(<span class="dig">1</span>)
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"No testrail key in settings"</span>
        exit(<span class="dig">1</span>)

    title = <span class="str">""</span>
    png = <span class="str">""</span>
    t15 = <span class="dig">0</span>
    t30 = <span class="dig">0</span>
    t60 = <span class="dig">0</span>
    durations = [<span class="dig">60</span>,<span class="dig">30</span>,<span class="dig">15</span>]
    tempfail=failcount
    temperr=errorcount
    <span class="kw">for</span> i <span class="kw">in</span> range(<span class="dig">0</span>,msongs.getGDAsongcount()):
        reportname=<span class="str">"Song-%d. record_momentsbeats - %s"</span> % (momentstestcounter,title)
        gda_utils.printreport(reportname,False)
        gda_utils.failcount+=gda_utils.failtotal
        gda_utils.failtotal=<span class="dig">0</span>
        gda_utils.passcount+=gda_utils.passtotal
        gda_utils.passtotal=<span class="dig">0</span>
        <span class="kw">if</span> errorcount&gt;temperr:
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
            <span class="kw">print</span> <span class="str">"ERROR EXCEPTIONS"</span>
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
            <span class="kw">print</span> exceptionlist
            <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>

        <span class="kw">if</span> failcount&gt;tempfail:
            <span class="kw">print</span> <span class="str">"::::::::::::::::::::::::::::::::::::::::::::"</span>
            <span class="kw">print</span> <span class="str">"WORKFLOW FAILURES"</span>
            <span class="kw">print</span> failmsglist
            <span class="kw">print</span> <span class="str">"::::::::::::::::::::::::::::::::::::::::::::"</span>
            <span class="cmt">#if failcount==3 or errorcount==3:    </span>
            <span class="cmt">#    gda,REGION=refreshscreenregion()</span>
        <span class="kw">if</span> failcount&gt;<span class="dig">6</span> <span class="kw">or</span> errorcount&gt;<span class="dig">6</span>: <span class="cmt">#restart the script if too many workflow errors</span>
            <span class="kw">print</span> <span class="str">"Exiting test run"</span>
            gda_utils.ScreenShot(REGION,<span class="str">""</span>,<span class="str">"FAILURES"</span>)
            exit(-<span class="dig">1</span>) <span class="cmt">#shell should be running in a loop and restart this run</span>
        tempfail=failcount
        temperr=errorcount
        rc=False
        d_song=None <span class="cmt">#the song node item</span>
        test=None <span class="cmt">#child test item of d_song</span>
        id=-<span class="dig">1</span>
        <span class="kw">print</span> <span class="str">"================================================="</span>
        <span class="kw">try</span>:
            title, png, t15, t30, t60 = msongs.getsortednextsong()
            rc,imgpath1,imgpath2= doesrecordfilesexists(png,gda_utils.d_gda_settings[<span class="str">"gda_music_images"</span>])

            momentstestcounter += <span class="dig">1</span>
            <span class="kw">if</span> <span class="kw">not</span> rc: <span class="cmt">#create all duration &amp; both region files for regression</span>
                d_testrail_songs=testrail_group(png) <span class="cmt"># with png music name return dict testrun test cases group</span>
                <span class="kw">if</span> <span class="kw">not</span> d_testrail_songs:
                    <span class="kw">continue</span>
                gda_music_tests.back(REGION) <span class="cmt">#get out of music screen if out of sync</span>
                d_song,id=getsongitem(png)
                <span class="kw">if</span> <span class="str">"FAILED"</span> <span class="kw">not</span> <span class="kw">in</span> d_song:
                    d_song[<span class="str">"FAILED"</span>]=<span class="str">""</span>
                <span class="kw">if</span> <span class="str">"PASSED"</span> <span class="kw">not</span> <span class="kw">in</span> d_song:
                    d_song[<span class="str">"PASSED"</span>]=<span class="str">""</span>
                <span class="cmt">#"work flows-------------------------------------------"</span>
                rc=selectmusicduration(REGION,<span class="dig">60</span>)
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    gda_utils.failtotal += <span class="dig">1</span>
                    e = <span class="str">" ERROR in selectmusicduration-%d: SKIPPING song %s"</span> % (<span class="dig">60</span>,title)
                    failmsglist += <span class="str">"\n%s\n"</span> % e
                    d_song[<span class="str">"FAILED"</span>] += e + <span class="str">"|"</span>
                    <span class="kw">print</span> e
                    rc=putsongitem(d_song,id) <span class="cmt"># update d_report of the song results        </span>
                    gda_utils.putDictToFile(d_report,gda_utils.d_gda_settings[<span class="str">"gda_create_tests_record_reportpath"</span>])
                    failcount+=<span class="dig">1</span>
                    <span class="kw">continue</span>

                rc=clearstory(REGION) <span class="cmt">#clear to reset for moments selection test</span>
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    gda_utils.failtotal+=<span class="dig">1</span>
                    e= <span class="str">" ERROR in clearstory: SKIPPING song %s"</span> % title
                    failmsglist += <span class="str">"\n%s\n"</span> % e
                    d_song[<span class="str">"FAILED"</span>]+=e+<span class="str">"|"</span>
                    <span class="kw">print</span> e
                    rc=putsongitem(d_song,id) <span class="cmt"># update d_report of the song results        </span>
                    gda_utils.putDictToFile(d_report,gda_utils.d_gda_settings[<span class="str">"gda_create_tests_record_reportpath"</span>])
                    failcount+=<span class="dig">1</span>
                    <span class="kw">continue</span>

                rc=createmoment() <span class="cmt">#set one moment so song iteration can select the next song</span>
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    gda_utils.failtotal+=<span class="dig">1</span>
                    e= <span class="str">" ERROR in createmoment: SKIPPING song %s"</span> % title
                    failmsglist += <span class="str">"\n%s\n"</span> % e
                    d_song[<span class="str">"FAILED"</span>]+=e+<span class="str">"|"</span>
                    <span class="kw">print</span> e
                    rc=putsongitem(d_song,id) <span class="cmt"># update d_report of the song results        </span>
                    gda_utils.putDictToFile(d_report,gda_utils.d_gda_settings[<span class="str">"gda_create_tests_record_reportpath"</span>])
                    failcount+=<span class="dig">1</span>
                    <span class="kw">continue</span>

                <span class="cmt">#tr_songtest=d_testrail_songs["song_tests"][0]</span>
                tr_songtest=get_test_title(d_testrail_songs[<span class="str">"song_tests"</span>], <span class="str">"Select Song"</span>)
                tr_passfail=<span class="str">"failed"</span>
                tr_elapsed=<span class="str">"1m"</span>
                tr_comment=<span class="str">"Sikuli Automation - %s - "</span> % tr_songtest[<span class="str">"title"</span>]
                rc=setmusic(REGION,png) <span class="cmt">#goto music screen and select the song iteration title and return to create screen                </span>
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    gda_utils.failtotal+=<span class="dig">1</span>
                    e = <span class="str">" ERROR in setmusic: SKIPPING song %s"</span> % title
                    failmsglist += <span class="str">"\n%s\n"</span> % e
                    d_song[<span class="str">"FAILED"</span>]+=e+<span class="str">"|"</span>
                    <span class="kw">print</span> e
                    rc = putsongitem(d_song,id) <span class="cmt"># update d_report of the song results</span>
                    gda_utils.putDictToFile(d_report,gda_utils.d_gda_settings[<span class="str">"gda_create_tests_record_reportpath"</span>])
                    failcount+=<span class="dig">1</span>
                    tc = report_to_testrail(tr_songtest, <span class="str">"failed"</span>, tr_elapsed, tr_comment)
                    <span class="kw">if</span> <span class="kw">not</span> tc:
                        <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                    <span class="kw">continue</span>

                tc=report_to_testrail(tr_songtest,<span class="str">"passed"</span>,tr_elapsed,tr_comment)
                <span class="kw">if</span> <span class="kw">not</span> tc:
                    <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                rc=clearstory(REGION) <span class="cmt">#clear to reset for moments selection test</span>
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    gda_utils.failtotal+=<span class="dig">1</span>
                    e = <span class="str">" ERROR in clearstory: SKIPPING song %s"</span> % title
                    failmsglist += <span class="str">"\n%s\n"</span> % e
                    d_song[<span class="str">"FAILED"</span>]+=e+<span class="str">"|"</span>
                    <span class="kw">print</span> e
                    rc=putsongitem(d_song,id) <span class="cmt"># update d_report of the song results        </span>
                    gda_utils.putDictToFile(d_report,gda_utils.d_gda_settings[<span class="str">"gda_create_tests_record_reportpath"</span>])
                    failcount+=<span class="dig">1</span>
                    <span class="kw">continue</span>

                <span class="cmt">#tr_songtest=d_testrail_songs["song_tests"][1]</span>
                tr_songtest = get_test_title(d_testrail_songs[<span class="str">"song_tests"</span>], <span class="str">"Moments Select Max 60"</span>)
                tr_comment=<span class="str">"Sikuli Automation - %s - "</span> % tr_songtest[<span class="str">"title"</span>]

                rc,test=selectmoments(REGION,t60,<span class="dig">60</span>,png)
                <span class="kw">if</span> test:
                    d_song[<span class="str">"selectmoments"</span>]=test
                <span class="kw">if</span> <span class="kw">not</span> rc:
                    gda_utils.failtotal+=<span class="dig">1</span>
                    e = <span class="str">" ERROR in selectmoments: SKIPPING song %s"</span> % title
                    failmsglist += <span class="str">"\n%s\n"</span> % e
                    d_song[<span class="str">"FAILED"</span>]+=e+<span class="str">"|"</span>
                    <span class="kw">print</span> e
                    rc=putsongitem(d_song,id) <span class="cmt"># update d_report of the song results        </span>
                    gda_utils.putDictToFile(d_report,gda_utils.d_gda_settings[<span class="str">"gda_create_tests_record_reportpath"</span>])
                    failcount+=<span class="dig">1</span>
                    tc=report_to_testrail(tr_songtest,<span class="str">"failed"</span>,tr_elapsed,tr_comment+e)
                    <span class="kw">if</span> <span class="kw">not</span> tc:
                        <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>

                    <span class="kw">continue</span>

                tc=report_to_testrail(tr_songtest,<span class="str">"passed"</span>,tr_elapsed,tr_comment)
                <span class="kw">if</span> <span class="kw">not</span> tc:
                    <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                <span class="kw">for</span> dur <span class="kw">in</span> durations:

                    <span class="kw">if</span> dur==<span class="dig">60</span>:
                        tr_songtest = get_test_title(d_testrail_songs[<span class="str">"song_tests"</span>], <span class="str">"Output MP4 60 Sec"</span>)
                        tr_comment = <span class="str">"Sikuli Automation - %s - "</span> % tr_songtest[<span class="str">"title"</span>]

                        rc,d_song=recordmomentsandbeats(REGION,d_song,png,dur,t60)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e = <span class="str">" ERROR in recordmomentsandbeats-%d: SKIPPING song %s"</span> % (dur,title)
                            tc = report_to_testrail(tr_songtest, <span class="str">"failed"</span>, tr_elapsed, tr_comment + e)
                            <span class="kw">if</span> <span class="kw">not</span> tc:
                                <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                            update_report(rc,<span class="str">"recordmomentsandbeats-60"</span>,e,title,d_song,id,<span class="str">"gda_create_tests_record_reportpath"</span>)
                            <span class="kw">break</span>
                        <span class="kw">else</span>:
                            rc,d_song = exportmp4(REGION,d_song,png,dur)
                            <span class="kw">if</span> <span class="kw">not</span> rc:
                                e = <span class="str">" ERROR in exportmp4-%d: SKIPPING song %s"</span> % (dur,title)
                                update_report(rc,<span class="str">"exportmp4-60"</span>,e,title,d_song,id,<span class="str">"gda_create_tests_record_reportpath"</span>)
                                tc = report_to_testrail(tr_songtest, <span class="str">"failed"</span>, tr_elapsed, tr_comment + e)
                                <span class="kw">if</span> <span class="kw">not</span> tc:
                                    <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                                <span class="kw">break</span>
                            tc = report_to_testrail(tr_songtest, <span class="str">"passed"</span>, tr_elapsed, tr_comment)
                            <span class="kw">if</span> <span class="kw">not</span> tc:
                                <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                    <span class="kw">elif</span> dur==<span class="dig">30</span>:
                        tr_songtest = get_test_title(d_testrail_songs[<span class="str">"song_tests"</span>], <span class="str">"Output MP4 30 Sec"</span>)
                        tr_comment = <span class="str">"Sikuli Automation - %s - "</span> % tr_songtest[<span class="str">"title"</span>]
                        rc=selectmusicduration(REGION,dur)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e= <span class="str">" ERROR in selectmusicduration-%d: SKIPPING song %s"</span> % (dur,title)
                            tc = report_to_testrail(tr_songtest, <span class="str">"failed"</span>, tr_elapsed, tr_comment + e)
                            <span class="kw">if</span> <span class="kw">not</span> tc:
                                <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                            update_report(rc,<span class="str">"select music duration-30"</span>,e,title,d_song,id,<span class="str">"gda_create_tests_record_reportpath"</span>)
                            <span class="kw">break</span>

                        rc,d_song=recordmomentsandbeats(REGION,d_song,png,dur,t30)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e = <span class="str">" ERROR in recordmomentsandbeats-%d: SKIPPING song %s"</span> % (dur,title)

                            tc = report_to_testrail(tr_songtest, <span class="str">"failed"</span>, tr_elapsed, tr_comment + e)
                            <span class="kw">if</span> <span class="kw">not</span> tc:
                                <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                            update_report(rc,<span class="str">"recordmomentsandbeats-30"</span>,e,title,d_song,id,<span class="str">"gda_create_tests_record_reportpath"</span>)
                            <span class="kw">break</span>
                        <span class="kw">else</span>:
                            rc,d_song = exportmp4(REGION,d_song,png,dur)
                            <span class="kw">if</span> <span class="kw">not</span> rc:
                                e = <span class="str">" ERROR in exportmp4-%d: SKIPPING song %s"</span> % (dur,title)
                                update_report(rc,<span class="str">"exportmp4-30"</span>,e,title,d_song,id,<span class="str">"gda_create_tests_record_reportpath"</span>)
                                <span class="kw">break</span>
                        tc = report_to_testrail(tr_songtest, <span class="str">"passed"</span>, tr_elapsed, tr_comment)
                        <span class="kw">if</span> <span class="kw">not</span> tc:
                            <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                    <span class="kw">elif</span> dur==<span class="dig">15</span>:
                        tr_songtest = get_test_title(d_testrail_songs[<span class="str">"song_tests"</span>], <span class="str">"Output MP4 15 Sec"</span>)
                        tr_comment = <span class="str">"Sikuli Automation - %s - "</span> % tr_songtest[<span class="str">"title"</span>]
                        rc=selectmusicduration(REGION,dur)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e= <span class="str">" ERROR in selectmusicduration-%d: SKIPPING song %s"</span> % (dur,title)
                            tc = report_to_testrail(tr_songtest, <span class="str">"failed"</span>, tr_elapsed, tr_comment + e)
                            <span class="kw">if</span> <span class="kw">not</span> tc:
                                <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                            update_report(rc,<span class="str">"select music duration-15"</span>,e,title,d_song,id,<span class="str">"gda_create_tests_record_reportpath"</span>)
                            <span class="kw">break</span>

                        rc,d_song=recordmomentsandbeats(REGION, d_song, png, dur, t15)
                        <span class="kw">if</span> <span class="kw">not</span> rc:
                            e = <span class="str">" ERROR in recordmomentsandbeats-%d: SKIPPING song %s"</span> % (dur,title)
                            tc = report_to_testrail(tr_songtest, <span class="str">"failed"</span>, tr_elapsed, tr_comment + e)
                            <span class="kw">if</span> <span class="kw">not</span> tc:
                                <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                            update_report(rc,<span class="str">"recordmomentsandbeats-30"</span>,e,title,d_song,id,<span class="str">"gda_create_tests_record_reportpath"</span>)
                            <span class="kw">break</span>
                        <span class="kw">else</span>:
                            rc,d_song = exportmp4(REGION,d_song,png,dur)
                            <span class="kw">if</span> <span class="kw">not</span> rc:
                                e = <span class="str">" ERROR in exportmp4-%d: SKIPPING song %s"</span> % (dur,title)
                                tc = report_to_testrail(tr_songtest, <span class="str">"failed"</span>, tr_elapsed, tr_comment + e)
                                <span class="kw">if</span> <span class="kw">not</span> tc:
                                    <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                                update_report(rc,<span class="str">"exportmp4-15"</span>,e,title,d_song,id,<span class="str">"gda_create_tests_record_reportpath"</span>)
                                <span class="kw">break</span>
                        tc = report_to_testrail(tr_songtest, <span class="str">"passed"</span>, tr_elapsed, tr_comment)
                        <span class="kw">if</span> <span class="kw">not</span> tc:
                            <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                    <span class="kw">else</span>:
                        e = <span class="str">" INVALID MOMENTS DURATION !!!!!!!!!!!!!!!"</span>
                        <span class="kw">print</span> e
                        tc = report_to_testrail(tr_songtest, <span class="str">"failed"</span>, tr_elapsed, tr_comment + e)
                        <span class="kw">if</span> <span class="kw">not</span> tc:
                            <span class="kw">print</span> <span class="str">"FAILED to report to TESTRAIL"</span>
                <span class="kw">if</span> rc:
                    <span class="cmt">#d_song["PASSED"]="True"</span>
                    update_report(rc,<span class="str">"Song Record Tests"</span>,<span class="str">"OK"</span>,title,d_song,id,<span class="str">"gda_create_tests_record_reportpath"</span>)
                rc = putsongitem(d_song,id) <span class="cmt"># update d_report of the song results</span>
                gda_utils.putDictToFile(d_report,gda_utils.d_gda_settings[<span class="str">"gda_create_tests_record_reportpath"</span>])
                gda_utils.putDictToFile(gda_utils.d_similarity)
                failcount=<span class="dig">0</span> <span class="cmt"># reset the failures</span>
                <span class="kw">print</span> <span class="str">"SAVED %d: Created file:\n%s\n%s"</span> % (momentstestcounter,imgpath1,imgpath2)
            <span class="kw">else</span>:
                <span class="kw">print</span> <span class="str">"SKIPPED %d: Found file:\n%s\n%s"</span> % (momentstestcounter,imgpath1,imgpath2)
                skippcount+=<span class="dig">1</span>
        <span class="kw">except</span> Exception <span class="kw">as</span> err:
            errorcount += <span class="dig">1</span>
            <span class="cmt">#stackinfo=traceback.format_exc()</span>
            tb = sys.exc_info()[<span class="dig">2</span>]
            tbinfo=<span class="str">""</span>
            tbinfo = traceback.extract_tb(tb)

            <span class="kw">print</span> tbinfo <span class="cmt"># should print a list with entries like</span>
            exceptionlist += <span class="str">"\n%i-----------------------\n%s\n%s\n"</span> % (errorcount,err,str(tbinfo))
            <span class="kw">print</span> <span class="str">"Error: %s"</span> % str(err)
            <span class="kw">print</span> <span class="str">"ERROR %d: File not saved"</span> % (momentstestcounter)

            <span class="kw">if</span> d_song <span class="kw">and</span> id&gt;-<span class="dig">1</span>:
                rc=putsongitem(d_song,id)
                gda_utils.putDictToFile(d_report,gda_utils.d_gda_settings[<span class="str">"gda_create_tests_record_reportpath"</span>])
                gda_utils.putDictToFile(gda_utils.d_similarity)
            <span class="kw">if</span> len(exceptionlist)&gt;<span class="dig">0</span>:
                <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
                <span class="kw">print</span> <span class="str">"ERROR EXCEPTIONS"</span>
                <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
                <span class="kw">print</span> exceptionlist
                <span class="kw">print</span> <span class="str">"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"</span>
                <span class="kw">print</span> <span class="str">"::::::::::::::::::::::::::::::::::::::::::::"</span>
                <span class="kw">print</span> <span class="str">"WORKFLOW FAILURES"</span>
                <span class="kw">print</span> failmsglist
                <span class="kw">print</span> <span class="str">"::::::::::::::::::::::::::::::::::::::::::::"</span>
                <span class="kw">print</span> <span class="str">"Exiting test run"</span>
                gda_utils.ScreenShot(REGION,<span class="str">""</span>,<span class="str">"ExceptionErrors"</span>)
                <span class="kw">if</span> errorcount&gt;<span class="dig">5</span>:
                    <span class="kw">print</span> <span class="str">"EXCEPTION ERRORS: Too many errors=%i exiting this run"</span> % errorcount
                    exit(-<span class="dig">1</span>)
            <span class="cmt">#gda,REGION=refreshscreenregion()       </span>

<span class="cmt"># record_momentsbeats &lt;&lt;&lt;&lt;        </span>

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################    </span>
<span class="kw">def</span> story(REGION,duration,moments,png=None):
    <span class="kw">global</span> momentstestcounter
    gda_utils.WAIT(REGION,Pattern(<img src="create_txt_media.png" />).similar(<span class="dig">0.91</span>),<span class="dig">5</span>) <span class="cmt"># create_txt_media.png</span>
    recordmomentsandbeats(REGION,png,duration)
    exit(-<span class="dig">1</span>)

    clearstory(REGION)


    <span class="kw">if</span> selectmoments(REGION,moments,duration):<span class="cmt">#REGION, momentscount,durationmode):</span>

        evalstory_60sec(REGION)
        evalstory_30sec(REGION)
        evalstory_15sec(REGION)
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"ERROR: selectmoments"</span>

    clearstory(REGION)


<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################    </span>
<span class="kw">def</span> gda_create_tests(gpa, gpr,duration,moments):
    gpr=gda_utils.refreshregion(gpa)
    <span class="kw">if</span> gpr:
        story(gpr,duration,moments,<img src="song_RISEUP.png" />) <span class="cmt">#media screen</span>
        gda_utils.putDictToFile(gda_utils.d_similarity)
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"ERROR in DEBUG: No region found"</span>


<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> record_moments_beats(gpa,gpr):
    <span class="kw">print</span> <span class="str">"++++++++++++++++++++++++++++++++++"</span>
    <span class="kw">print</span> <span class="str">"RUN TEST: CAPTURE GDA_MUSIC_MOMENTS &amp; BEATS"</span>
    <span class="kw">print</span> <span class="str">"++++++++++++++++++++++++++++++++++"</span>
    record_momentsbeats(gpr)
    gda_utils.putDictToFile(gda_utils.d_similarity)
    gda_utils.printreport(<span class="str">"CAPTURE GDA_MUSIC_MOMENTS &amp; BEATS"</span>)

<span class="cmt">######################################</span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt"># </span>
<span class="cmt">######################################</span>
<span class="kw">def</span> gda_create_init(runmode_rec=False):
    <span class="kw">global</span> d_report
    <span class="kw">print</span> <span class="str">"gda_create_init &gt;&gt;&gt;&gt;&gt;&gt; %s"</span> % str(runmode_rec)
    gda_utils.d_gda_settings[<span class="str">"gda_create_tests_record_reportpath"</span>]=os.path.join(gda_utils.d_gda_settings[<span class="str">"gda_music_images"</span>],<span class="str">"gda_create_tests_record.json"</span>)
    gda_utils.d_gda_settings[<span class="str">"gda_create_tests_regression_reportpath"</span>]=os.path.join(gda_utils.d_gda_settings[<span class="str">"gda_music_images"</span>],<span class="str">"gda_create_tests_regression.json"</span>)
    rmode=<span class="str">"gda_create_tests_regression_reportpath"</span>

    _os=<span class="str">"Mac%s"</span> % (gda_utils.d_gda_settings[<span class="str">'OSVersion'</span>])
    d_report[<span class="str">'version'</span>]=<span class="str">"%s:%s"</span> % (_os,gda_utils.d_gda_settings[<span class="str">'version'</span>])
    <span class="kw">if</span> gda_utils.d_gda_settings[<span class="str">"isWindows"</span>]==<span class="str">"True"</span>:
        _os=<span class="str">"Win%s"</span> % (gda_utils.d_gda_settings[<span class="str">'OSVersion'</span>])
        d_report[<span class="str">'version'</span>]=<span class="str">"%s:%s"</span> % (_os,gda_utils.d_gda_settings[<span class="str">'version'</span>])
    <span class="kw">print</span> <span class="str">"=================="</span>
    <span class="kw">print</span> d_report[<span class="str">'version'</span>]
    <span class="kw">print</span> <span class="str">"=================="</span>
    <span class="kw">if</span> runmode_rec:
        rmode=<span class="str">"gda_create_tests_record_reportpath"</span>
        <span class="kw">print</span> rmode
        d_report=gda_utils.getDictFromFile(gda_utils.d_gda_settings[rmode])
    <span class="kw">else</span>:
        d_report=gda_utils.getDictFromFile(gda_utils.d_gda_settings[rmode])
    <span class="kw">if</span> <span class="kw">not</span> d_report:
        d_report={}

    msongs=gda_music_tests.GDA_music()
    <span class="kw">if</span> <span class="kw">not</span> msongs.isready:
        <span class="kw">print</span> <span class="str">"FAILED gda_create_init: msongs.isready"</span>
        <span class="kw">print</span> <span class="str">"gda_create_init &lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
        <span class="kw">return</span> None
    <span class="cmt">#New run we set the default from GDA music list into the d_report json</span>
    <span class="kw">if</span> (<span class="str">"songs"</span> <span class="kw">not</span> <span class="kw">in</span> d_report) <span class="kw">or</span> (len(d_report[<span class="str">"songs"</span>])&lt;<span class="dig">199</span>):
        <span class="kw">print</span> <span class="str">"Generating new gda_create_tests_record.json  file"</span>

        <span class="kw">if</span> <span class="kw">not</span> msongs:
            <span class="kw">print</span> <span class="str">"FAILED to init music song list gda_music_tests.GDA_music"</span>
            <span class="kw">print</span> <span class="str">"gda_create_init &lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
            exit(-<span class="dig">1</span>)
        <span class="kw">elif</span> msongs.getGDAsongcount()&lt;<span class="dig">199</span>:
            <span class="kw">print</span> <span class="str">"FAILED invalid number of songs=%i of 199"</span> % msongs.getGDAsongcount()
            <span class="kw">print</span> <span class="str">"gda_create_init &lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
            exit(-<span class="dig">2</span>)

        d_report[<span class="str">"songs"</span>]=msongs.songreport()

    gda_music_tests.testmusic_init(msongs)
    <span class="kw">if</span> <span class="str">"processed_songs"</span> <span class="kw">in</span> d_report:
        <span class="kw">print</span> <span class="str">"found %d songs processed"</span> % len(d_report[<span class="str">"processed_songs"</span>])
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"Starting new song record process"</span>
        d_report[<span class="str">"processed_songs"</span>]=[]
    <span class="kw">print</span> <span class="str">"gda_create_init &lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>

    <span class="kw">return</span> msongs


<span class="kw">def</span> refreshscreenregion():
    gpa,gpr=gda_utils.AppStart(<span class="str">"Quik"</span>)
    set_CREATE_SCREEN_regions(gpr)
    gda_music_tests.set_MUSIC_SCREEN_regions(gpr)
    <span class="kw">return</span> gpa,gpr


<span class="cmt">######################################</span>
<span class="cmt">#  T E S T R A I L</span>

<span class="cmt"># testrailtestlist=[" - 1.Select Song",</span>
<span class="cmt">#                   " - 2.Moments Select Max 60",</span>
<span class="cmt">#                   " - 3.Output MP4 60 Sec",</span>
<span class="cmt">#                   " - 4.Output MP4 30 Sec",</span>
<span class="cmt">#                   " - 5.Output MP4 15 Sec",</span>
<span class="cmt">#                   " - 6.MP4 in Edits-Scene Detect-60 Sec",</span>
<span class="cmt">#                   " - 7.MP4 in Edits-Scene Detect-30 Sec",</span>
<span class="cmt">#                   " - 8.MP4 in Edits-Scene Detect-15 Sec",</span>
<span class="cmt">#                   " - 9.MP4 in Edits-Song Analysis-60 Sec",</span>
<span class="cmt">#                   " - 10.MP4 in Edits-Song Analysis-30 Sec",</span>
<span class="cmt">#                   " - 11.MP4 in Edits-Song Analysis-15 Sec"]</span>

<span class="kw">def</span> get_test_title(mtestrail, testtext):
    <span class="kw">print</span> <span class="str">"get_test_title &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>
    <span class="kw">print</span> str(mtestrail)
    <span class="kw">for</span> test <span class="kw">in</span> mtestrail:
        <span class="kw">if</span> testtext <span class="kw">in</span> test[<span class="str">"title"</span>]:
            <span class="kw">return</span> test
    <span class="kw">print</span> <span class="str">"get_test_title &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>
    <span class="kw">return</span> None

<span class="kw">def</span> report_to_testrail(tr_songitem,passfail,elapsed,comment):
    <span class="kw">if</span> <span class="kw">not</span> tr_songitem:
        <span class="kw">return</span> None
    <span class="cmt">#tr.setteststatus("passed",test["id"],test["run_id"],"2s",t)</span>
    <span class="cmt">#report_testrail_status(passfail, testid, runid, elapsed="5s",comment="sikuli automation reported status"):</span>
    <span class="cmt">#print str(tr_songitem)</span>
    new_test_status=gda_utils.report_testrail_status(passfail, tr_songitem[<span class="str">"id"</span>], tr_songitem[<span class="str">"run_id"</span>], elapsed, comment)
    <span class="kw">return</span> new_test_status



<span class="cmt">######################################</span>
<span class="cmt"># testrail_song_group finds all the song tests</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">######################################</span>
<span class="kw">def</span> testrail_group2(png):
    song_testrail={}
    tr=None
    <span class="kw">if</span> <span class="str">'testrail'</span> <span class="kw">in</span> gda_utils.d_gda_settings:
        tr=gda_utils.d_gda_settings[<span class="str">'testrail'</span>]
        <span class="kw">if</span> <span class="kw">not</span> tr:
            <span class="kw">print</span> <span class="str">"No Testrail object in settings"</span>
            <span class="kw">return</span> None
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"No testrail key in settings"</span>
        <span class="kw">return</span> None
    <span class="kw">print</span> <span class="str">"testrail_group:%s   &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span> % png
    name=png.replace(<img src=".png" />,<span class="str">""</span>).replace(<span class="str">"song_"</span>,<span class="str">""</span>)

    tlist = [name+<span class="str">" - 1.Select Song"</span>,
                      name+<span class="str">" - 2.Moments Select Max 60"</span>,
                      name+<span class="str">" - 3.Output MP4 60 Sec"</span>,
                      name+<span class="str">" - 4.Output MP4 30 Sec"</span>,
                      name+<span class="str">" - 5.Output MP4 15 Sec"</span>,
                      name+<span class="str">" - 6.MP4 in Edits-Scene Detect-60 Sec"</span>,
                      name+<span class="str">" - 7.MP4 in Edits-Scene Detect-30 Sec"</span>,
                      name+<span class="str">" - 8.MP4 in Edits-Scene Detect-15 Sec"</span>,
                      name+<span class="str">" - 9.MP4 in Edits-Song Analysis-60 Sec"</span>,
                      name+<span class="str">" - 10.MP4 in Edits-Song Analysis-30 Sec"</span>,
                      name+<span class="str">" - 11.MP4 in Edits-Song Analysis-15 Sec"</span>]

    <span class="kw">for</span> t <span class="kw">in</span> tlist:
        <span class="kw">print</span> <span class="str">"-----------------------------"</span>
        test=tr.find_test_name(t)
        <span class="kw">if</span> test <span class="kw">and</span> <span class="str">"title"</span> <span class="kw">in</span> test:
            <span class="kw">print</span> test[<span class="str">"title"</span>]
            <span class="kw">if</span> test[<span class="str">"status_id"</span>] != <span class="dig">1</span>:
                testlist=tr.find_all_test_contains_name(name)
                <span class="kw">print</span> str(testlist)
            <span class="kw">print</span> <span class="str">"PASSED: Skipped"</span>
        <span class="kw">else</span>:
            <span class="kw">print</span> <span class="str">"test not found %s"</span> % t

<span class="cmt">######################################</span>
<span class="cmt"># testrail_song_group finds all the song tests</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">######################################</span>
<span class="kw">def</span> testrail_group(png):
    song_testrail = {}
    tr = None
    <span class="kw">if</span> <span class="str">'testrail'</span> <span class="kw">in</span> gda_utils.d_gda_settings:
        tr = gda_utils.d_gda_settings[<span class="str">'testrail'</span>]
        <span class="kw">if</span> <span class="kw">not</span> tr:
            <span class="kw">print</span> <span class="str">"No Testrail object in settings"</span>
            <span class="kw">return</span> None
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"No testrail key in settings"</span>
        <span class="kw">return</span> None
    <span class="kw">print</span> <span class="str">"testrail_group:%s   &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span> % png
    name = png.replace(<img src=".png" />, <span class="str">""</span>).replace(<span class="str">"song_"</span>, <span class="str">""</span>)

    <span class="kw">print</span> <span class="str">"-----------------------------"</span>

    song_testrail[<span class="str">"song_tests"</span>] = tr.find_all_test_contains_name(name)
    <span class="kw">if</span> song_testrail[<span class="str">"song_tests"</span>] <span class="kw">and</span> len(song_testrail[<span class="str">"song_tests"</span>]) &gt; <span class="dig">0</span>:
        <span class="kw">for</span> i <span class="kw">in</span> range(<span class="dig">0</span>, len(song_testrail[<span class="str">"song_tests"</span>])):
            title = song_testrail[<span class="str">"song_tests"</span>][i][<span class="str">"title"</span>]
            song_testrail[title] = i
    <span class="kw">else</span>:
        song_testrail = None
    <span class="kw">return</span> song_testrail



                <span class="cmt">#gda_music_tests.set_MUSIC_SCREEN_regions(gpr)</span>

    <span class="cmt">#flist=os.listdir("/Users/keithfisher/Dropbox (GoPro)/gda_music_images/160725")</span>
    <span class="cmt">#for item in flist:</span>
    <span class="cmt">#    print item</span>
<span class="kw">def</span> gettestofgroup(findtest,testgroup):
    <span class="kw">for</span> test <span class="kw">in</span> testgroup:
        <span class="kw">if</span> findtest <span class="kw">in</span> test[<span class="str">"title"</span>]:
            <span class="kw">return</span> test

<span class="cmt">############################################################################</span>
<span class="cmt">############################################################################</span>
<span class="cmt">############################################################################</span>
<span class="cmt"># D E B U G G I N G</span>

<span class="cmt">######################################</span>
<span class="cmt"># for debugging in sikuli ide</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">######################################</span>
<span class="kw">def</span> test_module1():
    gda_utils.GetEnvInfo()
    gpa, gpr = gda_utils.AppStart(<span class="str">"GoPro Quik"</span>)
    <span class="cmt"># record_momentsbeats(gpr)</span>

    <span class="cmt"># set_CREATE_SCREEN_regions(gpr)</span>

    <span class="cmt"># gda_music_tests.set_MUSIC_SCREEN_regions(gpr)</span>
    regression_momentsbeats(gpr)


<span class="cmt">######################################</span>
<span class="cmt"># for debugging in sikuli ide</span>
<span class="cmt">#</span>
<span class="cmt">#</span>
<span class="cmt">######################################</span>
<span class="kw">def</span> test_module2():
    gda_utils.d_gda_settings[ <span class="str">"NO-TestRail"</span>]=True
    gda_utils.GetEnvInfo()
    gpa, REGION = gda_utils.AppStart(<span class="str">"GoPro Quik"</span>)
    msongs = gda_create_init()
    <span class="cmt"># exit(1)</span>
    set_CREATE_SCREEN_regions(REGION)

    <span class="kw">for</span> i <span class="kw">in</span> range(<span class="dig">1</span>, <span class="dig">10</span>):
        <span class="cmt"># set_CREATE_SCREEN_regions(REGION)</span>
        <span class="cmt"># continue</span>
        rc = selectmusicduration(REGION, <span class="dig">60</span>)
        <span class="kw">if</span> <span class="kw">not</span> rc:
            <span class="kw">print</span> <span class="str">"FAILED selectmusicduration(REGION,60)"</span>
            <span class="kw">break</span>
        rc = selectmusicduration(REGION, <span class="dig">30</span>)
        <span class="kw">if</span> <span class="kw">not</span> rc:
            <span class="kw">print</span> <span class="str">"FAILED selectmusicduration(REGION,30)"</span>
            <span class="kw">break</span>
        rc = selectmusicduration(REGION, <span class="dig">30</span>)
        <span class="kw">if</span> <span class="kw">not</span> rc:
            <span class="kw">print</span> <span class="str">"FAILED selectmusicduration(REGION,30)"</span>
            <span class="kw">break</span>
        rc = selectmusicduration(REGION, <span class="dig">15</span>)
        <span class="kw">if</span> <span class="kw">not</span> rc:
            <span class="kw">print</span> <span class="str">"FAILED selectmusicduration(REGION,15)"</span>
            <span class="kw">break</span>
        <span class="kw">continue</span>

        title = <img src="song_dog.png" />
        dur = <span class="dig">60</span>
        rc = selectmusicduration(REGION, dur)
        <span class="kw">if</span> <span class="kw">not</span> rc:
            <span class="kw">print</span> <span class="str">"FAILED selectmusicduration(REGION,dur)"</span>

        rc, d_song = recordmomentsandbeats(REGION, d_song, png, dur, dur)
        <span class="kw">if</span> <span class="kw">not</span> rc:
            e = <span class="str">"ERROR in recordmomentsandbeats-%d: SKIPPING song %s"</span> % (dur, title)
            <span class="kw">print</span> e
        dur = <span class="dig">30</span>
        rc = selectmusicduration(REGION, dur)
        <span class="kw">if</span> <span class="kw">not</span> rc:
            e = <span class="str">"ERROR in selectmusicduration-%d: SKIPPING song %s"</span> % (dur, title)
            <span class="kw">print</span> e
        rc, d_song = recordmomentsandbeats(REGION, d_song, png, dur, dur)
        <span class="kw">if</span> <span class="kw">not</span> rc:
            e = <span class="str">"ERROR in recordmomentsandbeats-%d: SKIPPING song %s"</span> % (dur, title)
            <span class="kw">print</span> e
        dur = <span class="dig">15</span>
        rc = selectmusicduration(REGION, dur)
        <span class="kw">if</span> <span class="kw">not</span> rc:
            e = <span class="str">"ERROR in selectmusicduration-%d: SKIPPING song %s"</span> % (dur, title)
            <span class="kw">print</span> e
        rc, d_song = recordmomentsandbeats(REGION, d_song, png, dur, dur)
        <span class="kw">if</span> <span class="kw">not</span> rc:
            e = <span class="str">"ERROR in recordmomentsandbeats-%d: SKIPPING song %s"</span> % (dur, title)
            <span class="kw">print</span> e


<span class="kw">def</span> test_module3():
    gda_utils.d_gda_settings[<span class="str">'version'</span>]=<span class="str">"debugQuik_mac"</span>
    gda_utils.d_gda_settings[<span class="str">"NO-TestRail"</span>]=True

    gda_utils.GetEnvInfo()
    gpa,REGION=gda_utils.AppStart(<span class="str">"GoPro Quik"</span>)
    <span class="cmt">#msongs=gda_create_init()</span>

    set_CREATE_SCREEN_regions(REGION)
    d_song={}
    <span class="cmt">#title, png, t15, t30, t60 = msongs.getsortednextsong()</span>
    png = <img src="song_TEST%d.png" /> % <span class="dig">1</span>
    <span class="cmt">#d_song=testrail_group(png)</span>
    rc,d_song=exportmp4(REGION,d_song,png,<span class="dig">1</span>)


<span class="kw">def</span> test_module4():
    gda_utils.d_gda_settings[<span class="str">'version'</span>]=<span class="str">"debugQuik_win"</span>
    gda_utils.d_gda_settings[<span class="str">"NO-TestRail"</span>]=True

    gda_utils.GetEnvInfo()
    gpa,REGION=gda_utils.AppStart(<span class="str">"GoPro Quik"</span>)
    msongs=gda_create_init()
    <span class="cmt">#exit(1)</span>
    set_CREATE_SCREEN_regions(REGION)
    gda_music_tests.set_MUSIC_SCREEN_regions(REGION)
    selectmusic(REGION)
    gda_music_tests.cancelmusicscreen()
    selectmusicduration(REGION,<span class="dig">15</span>)
    selectmusicduration(REGION,<span class="dig">30</span>)
    selectmusicduration(REGION,<span class="dig">60</span>)
    selectmusicduration(REGION,<span class="dig">30</span>)
    selectmusicduration(REGION,<span class="dig">15</span>)
    selectmusicduration(REGION,<span class="dig">60</span>)

    exit(<span class="dig">1</span>)
    <span class="cmt">#rc=popup_areyousure_deletefile(REGION)</span>
    d_song={}
    tr=None
    <span class="kw">if</span> <span class="str">'testrail'</span> <span class="kw">in</span> gda_utils.d_gda_settings:
        tr=gda_utils.d_gda_settings[<span class="str">'testrail'</span>]
        <span class="kw">if</span> <span class="kw">not</span> tr:
            <span class="kw">print</span> <span class="str">"No Testrail object in settings"</span>
            exit(<span class="dig">1</span>)
    <span class="kw">else</span>:
        <span class="kw">print</span> <span class="str">"No testrail key in settings"</span>
        exit(<span class="dig">1</span>)
    <span class="kw">print</span> <span class="str">"testcases found=%d"</span> % len(tr.testcases)
    <span class="kw">for</span> i <span class="kw">in</span> range(<span class="dig">1</span>,<span class="dig">200</span>):
        <span class="kw">print</span> <span class="str">"======================================================"</span>
        title, png, t15, t30, t60 = msongs.getsortednextsong()
        <span class="kw">print</span> png
        testgrp=[<span class="str">" - Select Song"</span>, <span class="str">" - Moments Select Max 60"</span>, <span class="str">" - Output MP4 60 Sec"</span>,<span class="str">" - Output MP4 30 Sec"</span>,<span class="str">" - Output MP4 15 Sec"</span>]
        d_song=testrail_group(png)
        <span class="kw">if</span> d_song:
            <span class="kw">print</span> str(d_song)

            <span class="kw">for</span> test <span class="kw">in</span> testgrp: <span class="cmt">#d_song["song_tests"]:</span>
                <span class="kw">print</span> <span class="str">"------------------------------------"</span>
                tr_songtest=gettestofgroup(test,d_song[<span class="str">"song_tests"</span>])
                <span class="cmt">#tr_songtest=test</span>
                tr_passfail=<span class="str">"failed"</span>
                tr_elapsed=<span class="str">"1m"</span>
                tr_comment=<span class="str">"FAILED: Sikuli Automation - %s - "</span> % tr_songtest[<span class="str">"title"</span>]
                n=randint(<span class="dig">1</span>,<span class="dig">6</span>)
                <span class="kw">if</span> n&gt;<span class="dig">1</span>:
                    tr_passfail=<span class="str">"passed"</span>
                    tr_comment = <span class="str">"Sikuli Automation - %s - "</span> % tr_songtest[<span class="str">"title"</span>]
                <span class="kw">print</span> <span class="str">"%s - %s"</span> % (tr_songtest[<span class="str">"title"</span>], str(tr_songtest))
                tc = report_to_testrail(tr_songtest, tr_passfail, tr_elapsed, tr_comment)
                <span class="kw">print</span> str(tc)
                <span class="kw">if</span> n==<span class="dig">1</span>:
                    <span class="kw">break</span>
    exit(<span class="dig">1</span>)
        <span class="cmt"># tlist=[]</span>
        <span class="cmt"># s="%s - Select Song" % name</span>
        <span class="cmt"># tlist.append(s)</span>
        <span class="cmt"># s="%s - Moments Select Max 60" % name</span>
        <span class="cmt"># tlist.append(s)</span>
        <span class="cmt"># s="%s - Output MP4 60 Sec" % name</span>
        <span class="cmt"># tlist.append(s)</span>
        <span class="cmt"># s="%s - Output MP4 30 Sec" % name</span>
        <span class="cmt"># tlist.append(s)</span>
        <span class="cmt"># s="%s - Output MP4 15 Sec" % name</span>
        <span class="cmt"># tlist.append(s)</span>
        <span class="cmt"># s="%s - MP4 Edits Scene Detect" % name</span>
        <span class="cmt"># tlist.append(s)</span>
        <span class="cmt"># s="%s - Song Analysis" % name</span>
        <span class="cmt"># tlist.append(s)</span>

        <span class="cmt"># for t in tlist:</span>
        <span class="cmt">#     print "-----------------------------"</span>
        <span class="cmt">#     test=tr.find_test_name(t)</span>
        <span class="cmt">#     if test and "title" in test:</span>
        <span class="cmt">#         print test["title"]</span>
        <span class="cmt">#         if test["status_id"] != 1:</span>
        <span class="cmt">#             teststatus=tr.setteststatus("passed",test["id"],test["run_id"],"2s",t)</span>
        <span class="cmt">#             print str(teststatus)</span>
        <span class="cmt">#         print "PASSED: Skipped"</span>
        <span class="cmt">#     else:</span>
        <span class="cmt">#         print "test not found %s" % t</span>
    <span class="cmt">#exit(1)               </span>
        <span class="cmt">#png = "song_TEST%d.png" % i</span>
        <span class="cmt">#rc,d_song=exportmp4(REGION,d_song,png,i)</span>

<span class="cmt">#    scrubtest(REGION)</span>


<span class="cmt">######################################</span>
<span class="cmt"># for debugging in sikuli ide</span>
<span class="cmt"># </span>
<span class="cmt"># KEEP THIS COMMENTED when checking in to GIT</span>
<span class="cmt">######################################    </span>
<span class="cmt">#test_module1()</span>
<span class="cmt">#test_module4()</span>
<span class="cmt">#test_module3()</span>



<span class="cmt"># record_momentsbeats</span>
<span class="cmt">#       set_CREATE_SCREEN_regions(REGION)</span>
<span class="cmt">#       gda_music_tests.back(REGION)</span>
<span class="cmt">#       gda_utils.EXISTS3</span>
<span class="cmt">#       msongs=gda_create_init("2.0.0.9999")</span>
<span class="cmt">#       clearstory(REGION)</span>
<span class="cmt">#       init_music(REGION,msongs)</span>
<span class="cmt">#       msongs.getGDAsongcount()</span>
<span class="cmt">#       gda_utils.printreport(reportname)</span>
<span class="cmt">#       title, png, t15, t30, t60 = msongs.getsortednextsong()</span>
<span class="cmt">#       rc,imgpath1,imgpath2= doesrecordfilesexists(png,gda_utils.d_gda_settings["gda_music_images"])</span>
<span class="cmt">#       selectmusicduration(REGION,60)</span>
<span class="cmt">#     setmusic(REGION,png)                </span>
<span class="cmt">#       clearstory(REGION)</span>
<span class="cmt">#       selectmoments(REGION,t60,60,png)</span>
<span class="cmt">#       recordmomentsandbeats(REGION,png,dur)</span>
<span class="cmt">#       gda_utils.putDictToFile(d_report,gda_utils.d_gda_settings["gda_create_tests_record_reportpath"])</span>

</pre>
</body>
</html>
